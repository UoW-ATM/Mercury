<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>Mercury.libs.uow_tool_belt.connection_tools API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../uow_tool_belt.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;Mercury.libs.uow_tool_belt</a>

            <img src="Mercury/mercury_logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#EmptyConnection">EmptyConnection</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="function" href="#extract_ssh_parameters">extract_ssh_parameters</a>
            </li>
            <li>
                    <a class="function" href="#read_cred">read_cred</a>
            </li>
            <li>
                    <a class="function" href="#generic_connection">generic_connection</a>
            </li>
            <li>
                    <a class="function" href="#mysql_connection">mysql_connection</a>
            </li>
            <li>
                    <a class="function" href="#file_connection">file_connection</a>
            </li>
            <li>
                    <a class="function" href="#parquet_connection">parquet_connection</a>
            </li>
            <li>
                    <a class="function" href="#read_data">read_data</a>
            </li>
            <li>
                    <a class="function" href="#read_csv">read_csv</a>
            </li>
            <li>
                    <a class="function" href="#do_query">do_query</a>
            </li>
            <li>
                    <a class="function" href="#run_mysql_query">run_mysql_query</a>
            </li>
            <li>
                    <a class="function" href="#read_pickle">read_pickle</a>
            </li>
            <li>
                    <a class="function" href="#read_parquet">read_parquet</a>
            </li>
            <li>
                    <a class="function" href="#read_mysql">read_mysql</a>
            </li>
            <li>
                    <a class="function" href="#write_data">write_data</a>
            </li>
            <li>
                    <a class="function" href="#write_csv">write_csv</a>
            </li>
            <li>
                    <a class="function" href="#write_pickle">write_pickle</a>
            </li>
            <li>
                    <a class="function" href="#create_indexes_in_table">create_indexes_in_table</a>
            </li>
            <li>
                    <a class="function" href="#write_mysql">write_mysql</a>
            </li>
            <li>
                    <a class="function" href="#load_data_infile">load_data_infile</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../../Mercury.html">Mercury</a><wbr>.<a href="./../../libs.html">libs</a><wbr>.<a href="./../uow_tool_belt.html">uow_tool_belt</a><wbr>.connection_tools    </h1>

                
                        <input id="mod-connection_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-connection_tools-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">jn</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">.general_tools</span> <span class="kn">import</span> <span class="n">mysql_server</span><span class="p">,</span> <span class="n">ssh_client_connection</span><span class="p">,</span> <span class="n">yes</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="k">class</span> <span class="nc">EmptyConnection</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>		<span class="bp">self</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="k">def</span> <span class="nf">extract_ssh_parameters</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>	<span class="c1"># TODO: put a path profile, like mysql_connection</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>	<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>	<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>	<span class="kn">import</span> <span class="nn">general_tools</span> <span class="k">as</span> <span class="nn">gt</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>	<span class="n">pouet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)))</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>	<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jn</span><span class="p">(</span><span class="n">pouet</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>	<span class="n">cred</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>	<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>	
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ssh_tunnel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_tunnel&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>		<span class="k">if</span> <span class="s1">&#39;ssh_username&#39;</span> <span class="ow">in</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">():</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>			<span class="n">ssh_auth</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;ssh_auth&#39;</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>			<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>			<span class="k">if</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;password&#39;</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>				<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>			<span class="k">elif</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;key&#39;</span><span class="p">:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>				<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>				<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>	<span class="k">return</span> <span class="n">kwargs</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="k">def</span> <span class="nf">read_cred</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>	<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>	<span class="k">if</span> <span class="n">path_profile</span>	<span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>		<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>		
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>	<span class="n">pat</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_profile</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>	<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pat</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>	<span class="k">return</span> <span class="n">cred</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="nd">@contextmanager</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="k">def</span> <span class="nf">generic_connection</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">	This a wrapper to uniformise remote (or local) connections for </span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">	files and databases.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>	<span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>		<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="n">path_profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>	<span class="k">elif</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>		<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>	<span class="k">elif</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>		<span class="k">with</span> <span class="n">parquet_connection</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>	<span class="k">elif</span> <span class="n">typ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>		<span class="k">yield</span> <span class="n">EmptyConnection</span><span class="p">()</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Type of connection&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;is not supported.&#39;</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="nd">@contextmanager</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="k">def</span> <span class="nf">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">	profile can be any string corresponding to a file &#39;db_profile_credentials.py&#39;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">	profile is ignored if a non-None engine is passed in argument.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">	Usage:</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">	mysql_connection(connection=something)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">	-&gt; passes down connection. All other parameters are ignored.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">	</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">	mysql_connection(profile=&#39;something&#39;) </span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">	-&gt; opens connection with profile. All other parameters except connection are ignored.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">	mysql_connection(username=..., password=...)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">	-&gt; creates a connection with these parameters</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">	mysql_connection()</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">	-&gt; creates an empty connection {&#39;type&#39;:&#39;mysql&#39;, &#39;engine&#39;:None, &#39;ssh_tunnel&#39;:None}</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>		<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;engine&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>				<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>				<span class="k">if</span> <span class="n">path_profile</span>	<span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>					<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>					
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>				<span class="n">pat</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_profile</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>				
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>				<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pat</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>				<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;database&#39;</span><span class="p">]:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>				<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;connector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;mysql_connector&#39;</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;connector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysqldb&#39;</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>				<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;DB connection to&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>				<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ssh_tunnel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_tunnel&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>					<span class="k">if</span> <span class="s1">&#39;ssh_username&#39;</span> <span class="ow">in</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">():</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>						<span class="n">ssh_auth</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;ssh_auth&#39;</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>						<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>						<span class="k">if</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;password&#39;</span><span class="p">:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>							<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>								<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>						<span class="k">elif</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;key&#39;</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>							<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>								<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>							<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>						<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;with ssh tunneling through&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;ssh_hostname&#39;</span><span class="p">])</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>						<span class="nb">print</span> <span class="p">()</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>		
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>			<span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;engine&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ssh_tunnel&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>			<span class="k">with</span> <span class="n">mysql_server</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">mysql_connection</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>				<span class="n">mysql_connection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>				<span class="k">yield</span> <span class="n">mysql_connection</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="nd">@contextmanager</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="k">def</span> <span class="nf">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">	To uniformise with mysql connection</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">	profile can be any string corresponding to a file &#39;db_profile_credentials.py&#39;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">	profile is ignored if a non-None engine is passed in argument.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>		<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>			<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>			<span class="k">if</span> <span class="n">path_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>				<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>			
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>			<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jn</span><span class="p">(</span><span class="n">path_profile</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>			<span class="k">if</span> <span class="n">base_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;base_path&#39;</span><span class="p">))</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>					<span class="k">raise</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>		
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">profile</span><span class="o">!=</span><span class="s1">&#39;local&#39;</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>			<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">]:</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>				<span class="k">if</span> <span class="ow">not</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>			<span class="k">with</span> <span class="n">ssh_client_connection</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh_connection</span><span class="p">:</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>				<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="n">ssh_connection</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>				<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>			<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="nd">@contextmanager</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="k">def</span> <span class="nf">parquet_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">	To uniformise with mysql connection</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">	profile can be any string corresponding to a file &#39;db_profile_credentials.py&#39;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">	profile is ignored if a non-None engine is passed in argument.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>		<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>			<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>			<span class="k">if</span> <span class="n">path_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>				<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>			<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jn</span><span class="p">(</span><span class="n">path_profile</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>			<span class="k">if</span> <span class="n">base_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;base_path&#39;</span><span class="p">))</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>					<span class="k">raise</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">profile</span><span class="o">!=</span><span class="s1">&#39;local&#39;</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>			<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">]:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>				<span class="k">if</span> <span class="ow">not</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>			<span class="k">with</span> <span class="n">ssh_client_connection</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh_connection</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>				<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="n">ssh_connection</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>				<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>			<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;parquet&#39;</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">	Wrapper designed to have uniformed input reading. The connection[&#39;type&#39;] value determinates is the data should</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">	be read as mysql or files. The fmt option can point to the type of files read. If the value</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">	kwargs[&#39;file_name&#39;] is present, the type of file will be inferred based on the extension of the file name, otherwise</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">	it will be assumed that the format is parquet. One can specify the fmt option to make this explicit. Note that the</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">	parquet format is less general than others, and that a &#39;scenario&#39; key must be specified in kwargs.</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">	Parameters</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">	==========</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">	fmt: string</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">		either &#39;mysql&#39;, &#39;csv&#39;, &#39;pickle&#39;, or &#39;parquet&#39;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">	connection: dictionary</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">		</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">	kwargs_mysql: dictionary</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">		additional key arguments to be passed to read_mysql.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">		Put select=None and query=&#39;something&#39; to directly pass a query.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">	Returns</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">	=======</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">	df: pandas Dataframe</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">	Note: automatic file format detection is not supported for parquet</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>		<span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>			<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>			<span class="c1"># Automatic detection of format</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>			<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>				<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>					<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>					<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>					<span class="c1"># Assume the user wants parquet</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;parquet&#39;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>		<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>			<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>				<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>				<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>				<span class="c1"># Assume the user wants parquet</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>				<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;parquet&#39;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>	<span class="k">if</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_mysql</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_pickle</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_parquet</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown format mode:&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>	<span class="k">return</span> <span class="n">df</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="k">def</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">):</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>	<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>		<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>		<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>		<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>			<span class="c1"># file is on a remote server, read it with sftp</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>			<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>			<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">))</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>				<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">remote_file</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>			<span class="c1"># file is local, read it directly.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>	<span class="k">return</span> <span class="n">df</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="k">def</span> <span class="nf">do_query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>	<span class="c1"># This section is required, otherwise the execute part below fails...</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>	<span class="k">try</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>		<span class="n">con</span><span class="o">.</span><span class="n">run_callable</span><span class="p">(</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>			<span class="n">con</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">has_table</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>		<span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>	<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>		<span class="c1"># using generic exception to catch errors from sql drivers (GH24988)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>		<span class="n">_is_table_name</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>	<span class="n">rs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>	<span class="k">return</span> <span class="n">rs</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="k">def</span> <span class="nf">run_mysql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">	This function whould be used only for queries that do not return data, e.g. table creation.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">	Indeed, the output of the function is unstructured, on the contrary of read_mysql</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>		<span class="n">engine</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>		<span class="n">rs</span> <span class="o">=</span> <span class="n">do_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>	<span class="k">return</span> <span class="n">rs</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byte</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">garbage</span><span class="p">):</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>	<span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>	<span class="k">if</span> <span class="n">byte</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>		<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>		<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>	<span class="c1"># if profile is None:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>	<span class="c1"># 	profile = &#39;local&#39;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>	<span class="c1">#print (connection)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>	<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>		<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>		<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>		<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>			<span class="c1"># file is on a remote server, read it with sftp</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>			<span class="c1"># folder creation on remote server.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>			<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>			<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">))</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>				<span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">remote_file</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>			<span class="c1"># file is local, read it directly.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>				<span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>			
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>	<span class="k">return</span> <span class="n">df</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="k">def</span> <span class="nf">read_parquet</span><span class="p">(</span><span class="n">scenario</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">garbage</span><span class="p">):</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">	This function allows to read parquets files like an SQL database, by providing an SQL query. The query is</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">	automatically cnverted to a format to be read with duckdb.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>	<span class="c1"># TODO: add ssh support and profile input</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>	<span class="kn">import</span> <span class="nn">duckdb</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>	<span class="c1">#duckdb.load_extension(&#39;spatial&#39;)s</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>	<span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>	<span class="n">convert_next_word</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>	<span class="n">words</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>		<span class="n">word_stripped</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>		<span class="k">if</span> <span class="n">convert_next_word</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>			<span class="n">w</span> <span class="o">=</span> <span class="s2">&quot;read_parquet(&#39;</span><span class="si">{}</span><span class="s2">.parquet&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;scenario=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scenario</span><span class="p">))</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">word_stripped</span><span class="p">))</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>			<span class="n">convert_next_word</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>			<span class="n">w</span> <span class="o">=</span> <span class="n">word_stripped</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>		<span class="k">if</span> <span class="n">word_stripped</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="s1">&#39;JOIN&#39;</span><span class="p">]:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>			<span class="c1"># test if join in something like join (select ...)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>			<span class="n">next_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">next_word</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(s&#39;</span> <span class="ow">or</span> <span class="n">next_word</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;( s&#39;</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>				<span class="n">convert_next_word</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>	<span class="n">df</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>	<span class="k">return</span> <span class="n">df</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="k">def</span> <span class="nf">read_mysql</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fromm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="p">{},</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">	Read something from sql. &#39;select&#39;, &#39;fromm&#39;, and &#39;conditions&#39; can be used for quick and dirty queries, but more </span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">	complex ones should be done with &#39;query&#39; directly by setting &#39;select&#39; to` &#39;None&#39;</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">	Parameters</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">	==========</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">	select: list of string</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">		name of attribute to get. If None, set to &#39;*&#39;. Ignored if query is not None.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">	fromm: string</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">		table name to query. Ignored if query is not None.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">	conditions: dictionnary</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">		keys are name of attributes and values are values to be matched by the attributes.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">		Ignored if query is not None.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">	query: string</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">		full query for the database. If None, attributes &#39;select&#39;, &#39;fromm&#39; and &#39;conditions&#39; are used.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">	engine: sqlalchemy engine object</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">		If given then it is used to do the connection,</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">		if missing then it is created based on user, password, address and</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">		db_name from db_connection</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">	options: dictionnary</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">		options to be passed on to the sqlalchemy engine.</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">	Returns</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">	=======</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">	df: pandas Dataframe</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">		with results</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>		<span class="n">engine</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>		<span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>			<span class="k">assert</span> <span class="ow">not</span> <span class="n">fromm</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>			<span class="k">if</span> <span class="n">select</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>				<span class="n">select</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span> 
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>			<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">select</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>				<span class="n">select_new</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>				<span class="k">for</span> <span class="n">stuff</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>					<span class="n">select_new</span> <span class="o">+=</span> <span class="n">stuff</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>				<span class="n">select</span> <span class="o">=</span> <span class="n">select_new</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>			<span class="k">elif</span> <span class="n">select</span><span class="o">==</span><span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>				<span class="k">pass</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>				<span class="k">pass</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>				<span class="c1">#raise Exception()</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>			<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT &#39;</span> <span class="o">+</span> <span class="n">select</span> <span class="o">+</span> <span class="s1">&#39; FROM &#39;</span> <span class="o">+</span> <span class="n">fromm</span> <span class="o">+</span> <span class="s1">&#39; WHERE &#39;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>			<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>				<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>					<span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>					<span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>				<span class="n">query</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>			<span class="k">if</span> <span class="n">conditions</span><span class="o">==</span><span class="p">{}:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>				<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>				<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>		<span class="k">if</span> <span class="n">index_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>		<span class="k">return</span> <span class="n">df</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">	Wrapper designed to have uniformed input writing.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">	Parameters</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">	==========</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">	what: pandas Dataframe object,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">		to be written</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">	where: string,</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">		name of file to get the data from if which=&#39;csv&#39; or &#39;pickle&#39;.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">		Name of table otherwise.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">	how: string,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">		either &#39;update&#39;, &#39;replace&#39;, or &#39;append&#39;. Define how the data should be added.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">		&#39;update&#39; only works with &#39;mysql&#39; right now.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">	which: string,</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">		either &#39;mysql&#39;, &#39;csv&#39;, or &#39;pickle&#39;.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">	kwargs_mysql: dictionary</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">		additional key arguments to be passed to write_sql.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>		<span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>			<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>			<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>				<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>					<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>					<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>		<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>			<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>				<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>				<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>	<span class="k">if</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>		<span class="n">write_mysql</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>		<span class="n">write_csv</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>		<span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown format mode:&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">create_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">):</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">!=</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>		<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;You chose to save in csv with mode&#39;</span><span class="p">,</span> <span class="n">how</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>		<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;This is not implemented yet, shall I switch to &#39;replace&#39;?&quot;</span><span class="p">):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>			<span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted&#39;</span><span class="p">)</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">==</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>		<span class="c1"># if profile is None:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>		<span class="c1"># 	profile = &#39;local&#39;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>		<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>			<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>				<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>			<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>			<span class="k">if</span> <span class="n">create_folder</span><span class="p">:</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>				<span class="n">full_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>										<span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>				<span class="c1"># file is on a remote server, write it with sftp</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>				<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>				<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>					<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">remote_file</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>				<span class="c1"># file is local, write it directly.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>				<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not implemented yet&#39;</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="k">def</span> <span class="nf">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">create_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">byte</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">):</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>	<span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">!=</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>		<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;You chose to save in pickle with mode&#39;</span><span class="p">,</span> <span class="n">how</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>		<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;This is not implemented yet, shall I switch to &#39;replace&#39;?&quot;</span><span class="p">):</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>			<span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted&#39;</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">==</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>		<span class="k">if</span> <span class="n">byte</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>			<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;wb&#39;</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>			<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>		<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>			<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>				<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>			<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>			<span class="k">if</span> <span class="n">create_folder</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>				<span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>										<span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>				<span class="c1"># file is on a remote server, write it with sftp</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>				<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>				<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>					<span class="c1">#df = pd.read_csv(remote_file, **other_paras)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>					<span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">remote_file</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>				<span class="c1"># file is local, write it directly.</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>					<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not implemented yet&#39;</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="k">def</span> <span class="nf">create_indexes_in_table</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="p">{},</span> <span class="n">indexes</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">primary</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">indexes</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>		<span class="c1">#Need at least one</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>		<span class="k">return</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>	<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;ALTEr TABLE &quot;</span><span class="o">+</span><span class="n">table</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>	
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">primary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">+</span><span class="s2">&quot; CHANGE COLUMN &quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">v</span><span class="o">+</span><span class="s2">&quot; NOT NULL, &quot;</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span> <span class="o">+</span> <span class="s2">&quot; ADD INDEX &quot;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>			<span class="n">sql</span> <span class="o">+=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot; ASC, &quot;</span><span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot;),&quot;</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>	<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">primary</span><span class="p">):</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; ADD PRIMARY KEY (&quot;</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">primary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>			<span class="n">sql</span> <span class="o">+=</span> <span class="n">k</span><span class="o">+</span><span class="s2">&quot;,&quot;</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot;),&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>	<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>	
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>	<span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a><span class="k">def</span> <span class="nf">write_mysql</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="n">key_for_update</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> 
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>	<span class="n">keys_for_update</span><span class="o">=</span><span class="p">{},</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">primary_dict</span><span class="o">=</span><span class="p">{},</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hard_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_temp_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a><span class="sd">	</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a><span class="sd">	Write a dataframe in the mysql database</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a><span class="sd">	Parameters</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a><span class="sd">	==========</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="sd">	data: pandas DataFrame object,</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="sd">		stuff to be put in database.</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a><span class="sd">	table_name: string,</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a><span class="sd">		name of table in database.</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a><span class="sd">	how: string,</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a><span class="sd">		either &#39;update&#39;, &#39;replace&#39;, or &#39;append&#39;.</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a><span class="sd">	key_for_update: string, int, float, or list</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a><span class="sd">		name of key(s) for table row matching.</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a><span class="sd">	engine: sqlalchemy engine object </span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a><span class="sd">		If given then it is used to do the connection,</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a><span class="sd">		if missing then it is created based on default parameters</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a><span class="sd">	TODO: harmonise keys_for_update and key_for_update</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="sd">	</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>	<span class="kn">import</span> <span class="nn">sqlalchemy</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>		<span class="n">engine</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>		
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>		<span class="c1">#create_primary_keys = not engine.dialect.has_table(table_name)</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>		<span class="n">create_primary_keys</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>		<span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>			<span class="n">question</span> <span class="o">=</span> <span class="s1">&#39;You chose to replace the following database (engine: </span><span class="si">{}</span><span class="s1">) table in output:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">])</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>			<span class="n">question</span> <span class="o">+=</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>			<span class="n">question</span> <span class="o">+=</span> <span class="s1">&#39;Are you sure?&#39;</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">yes</span><span class="p">(</span><span class="n">question</span><span class="p">):</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>				<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;Should I switch to &#39;update&#39;? (You can still save in cvs if you say no)&quot;</span><span class="p">):</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>					<span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;update&#39;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>					<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;Do you want to save the results in cvs? (Run is aborted otherwise)&quot;</span><span class="p">):</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>						<span class="n">file_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Type a name for the csv file:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>						<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted&#39;</span><span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>		<span class="k">if</span> <span class="n">how</span> <span class="o">!=</span> <span class="s1">&#39;update&#39;</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>			<span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="n">how</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>			<span class="c1">#if hard_update:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>			<span class="c1"># Remove all entries with attributes matching the ones given in keys_for_update.</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>			<span class="c1"># TODO: This is slow and stupid, use mysql &#39;SET&#39; command</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>			<span class="k">if</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>				<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>					<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;DELETE FROM &#39;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s1">&#39; WHERE &#39;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>					<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">keys_for_update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>						<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>							<span class="n">query</span> <span class="o">+=</span>  <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; AND &#39;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>						<span class="k">else</span><span class="p">:</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>							<span class="n">query</span> <span class="o">+=</span>  <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>					<span class="n">rs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>				<span class="c1"># Check if all columns are in the existing table, otherwise create them </span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>				<span class="n">df_test</span> <span class="o">=</span> <span class="n">read_mysql</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s2">&quot; LIMIT 1&quot;</span><span class="p">,</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>									<span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>				<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>					<span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>						<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Trying to add column&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;table.&quot;</span><span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>						<span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>						<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>							<span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;FLOAT&#39;</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>						<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]:</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>							<span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;INT&#39;</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>						<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>							<span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;VARCHAR(100)&#39;</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>						<span class="c1"># elif type(data.loc[mask, col].iloc[0]) in [list, tuple]:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>						<span class="c1"># 	max_car = max([len(data.loc[mask, col].iloc[i]) for i in range(len(data.loc[mask, col]))])</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>						<span class="c1"># 	typ = &#39;VARCHAR(&#39; + str(max_car*10) + &#39;)&#39;</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>						<span class="k">else</span><span class="p">:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>							<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Column:&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>							<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not sure which type of variable I should use for:&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>						
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>						<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ADD COLUMN `&quot;</span> <span class="o">+</span>\
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>								<span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;` &quot;</span> <span class="o">+</span> <span class="n">typ</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>						<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Attempting to create new column with query:&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>						<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>			<span class="k">if</span> <span class="n">use_temp_csv</span><span class="p">:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>				<span class="c1"># TODO: replace this with odo (see below)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>				<span class="n">load_data_infile</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>				<span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">],</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>			<span class="c1"># else:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>			<span class="c1"># 	# Check whether the table exists</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>			<span class="c1"># 	try:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>			<span class="c1"># 		sql = &quot;&quot;&quot;SELECT * FROM {} LIMIT 1&quot;&quot;&quot;.format(table_name)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>			<span class="c1"># 		dff = read_mysql(query=sql, connection=connection)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>			<span class="c1"># 		# If it does, update</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>			<span class="c1"># 		_update_table(data, table_name, key_for_update, connection=connection)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>			<span class="c1"># 	except sqlalchemy.exc.ProgrammingError:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>			<span class="c1"># 		# Otherwise, use pandas to create it and dump the data</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>			<span class="c1"># 		data.to_sql(table_name, connection[&#39;engine&#39;], if_exists=&#39;append&#39;, index=index)		</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>	<span class="k">if</span> <span class="n">create_primary_keys</span><span class="p">:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>		<span class="n">create_indexes_in_table</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>								<span class="n">table</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>								<span class="n">primary</span><span class="o">=</span><span class="n">primary_dict</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>								<span class="n">indexes</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a><span class="k">def</span> <span class="nf">_update_table</span><span class="p">(</span><span class="n">new_table</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">key_for_update</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>	<span class="c1"># Not sure this works....</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>		<span class="c1"># Get the existing table</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT * FROM &quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">table_name</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>		<span class="n">dff</span> <span class="o">=</span> <span class="n">read_mysql</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">sql</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>		
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>		<span class="n">mask</span> <span class="o">=</span> <span class="n">new_table</span><span class="p">[</span><span class="n">key_for_update</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">dff</span><span class="p">[</span><span class="n">key_for_update</span><span class="p">])</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>		
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>		<span class="c1"># Add columns missing in DB</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>		<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE &quot;</span> <span class="o">+</span> <span class="n">table_name</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>		<span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>		<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">new_table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dff</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a>				<span class="n">typ</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>				<span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]:</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>					<span class="n">type_sql</span> <span class="o">=</span> <span class="s1">&#39;INT&#39;</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>				<span class="k">elif</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>					<span class="n">type_sql</span> <span class="o">=</span> <span class="s1">&#39;FLOAT&#39;</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>				<span class="k">elif</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>					<span class="n">type_sql</span> <span class="o">=</span> <span class="s1">&#39;VARCHAR(255)&#39;</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>					<span class="nb">print</span> <span class="p">(</span><span class="n">typ</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>					
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>				<span class="n">query</span> <span class="o">+=</span> <span class="s1">&#39; ADD &#39;</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">type_sql</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>				
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">&gt;</span><span class="n">l</span><span class="p">:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>			<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>			
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>			<span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>		
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>		<span class="c1"># Update existing rows</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>		<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">new_table</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>			<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE &quot;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s2">&quot; SET&quot;</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>			<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">new_table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>				<span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_for_update</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>					<span class="n">value</span> <span class="o">=</span> <span class="n">new_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>					<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>						<span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>					<span class="k">elif</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>						<span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;NULL&#39;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>						<span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>					<span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span>  <span class="s2">&quot;,&quot;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>			<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>			<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key_for_update</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>				<span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; WHERE &quot;</span> <span class="o">+</span> <span class="n">key_for_update</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">key_for_update</span><span class="p">])</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>				<span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; WHERE &quot;</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_for_update</span><span class="p">:</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>					<span class="n">query</span> <span class="o">+=</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>				<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>			
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>			<span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>			
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>		<span class="c1"># Append other rows</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>		<span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">new_table</span><span class="p">[</span><span class="n">key_for_update</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">dff</span><span class="p">[</span><span class="n">key_for_update</span><span class="p">])</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>		<span class="n">new_table</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">],</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>        
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a><span class="c1">#Load data using cvs files</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a><span class="k">def</span> <span class="nf">load_data_infile</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deactivate_checks_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>	<span class="kn">import</span> <span class="nn">tempfile</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>	<span class="k">if</span> <span class="n">drop_table</span><span class="p">:</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS &quot;</span> <span class="o">+</span> <span class="n">table</span><span class="p">)</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>		<span class="n">create_table</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>	<span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>		<span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>	<span class="k">if</span> <span class="n">create_table</span><span class="p">:</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>		<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="p">]</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;TRUNCATE &quot;</span><span class="o">+</span><span class="n">table</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>	<span class="n">temp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>	<span class="k">try</span><span class="p">:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>		<span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">doublequote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>		<span class="k">if</span> <span class="n">deactivate_checks_keys</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set autocommit = 0;&#39;</span><span class="p">)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set unique_checks = 0;&#39;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set foreign_key_checks = 0&#39;</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>		<span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;`&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;`&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a>		
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;&quot;</span> <span class="o">+</span> <span class="n">temp</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>\
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>			   <span class="o">+</span> <span class="s2">&quot; INTO TABLE &quot;</span><span class="o">+</span><span class="n">table</span> \
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>			   <span class="o">+</span> <span class="s2">&quot; FIELDS TERMINATED BY &#39;,&#39;&quot;</span>\
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>			   <span class="o">+</span> <span class="s2">&quot; LINES TERMINATED BY &#39;</span><span class="se">\\</span><span class="s2">n&#39;&quot;</span>\
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>			   <span class="o">+</span> <span class="s2">&quot; IGNORE 1 LINES&quot;</span>\
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>			   <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;);&quot;</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>		<span class="c1">#print()</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>		<span class="c1">#print(&quot;-------&quot;)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>		<span class="c1">#print(sql)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>		<span class="c1">#print(&quot;-------&quot;)</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;commit;&#39;</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a>	<span class="k">finally</span><span class="p">:</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a>		<span class="k">if</span> <span class="n">deactivate_checks_keys</span><span class="p">:</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set autocommit = 1;&#39;</span><span class="p">)</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set unique_checks = 1;&#39;</span><span class="p">)</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set foreign_key_checks = 1&#39;</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a>		<span class="n">temp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="EmptyConnection">
                            <input id="EmptyConnection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EmptyConnection</span><wbr>(<span class="base">builtins.dict</span>):

                <label class="view-source-button" for="EmptyConnection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyConnection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyConnection-13"><a href="#EmptyConnection-13"><span class="linenos">13</span></a><span class="k">class</span> <span class="nc">EmptyConnection</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span id="EmptyConnection-14"><a href="#EmptyConnection-14"><span class="linenos">14</span></a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EmptyConnection-15"><a href="#EmptyConnection-15"><span class="linenos">15</span></a>		<span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="EmptyConnection-16"><a href="#EmptyConnection-16"><span class="linenos">16</span></a>		<span class="bp">self</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


    

                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="EmptyConnection.get" class="function">get</dd>
                <dd id="EmptyConnection.setdefault" class="function">setdefault</dd>
                <dd id="EmptyConnection.pop" class="function">pop</dd>
                <dd id="EmptyConnection.popitem" class="function">popitem</dd>
                <dd id="EmptyConnection.keys" class="function">keys</dd>
                <dd id="EmptyConnection.items" class="function">items</dd>
                <dd id="EmptyConnection.values" class="function">values</dd>
                <dd id="EmptyConnection.update" class="function">update</dd>
                <dd id="EmptyConnection.fromkeys" class="function">fromkeys</dd>
                <dd id="EmptyConnection.clear" class="function">clear</dd>
                <dd id="EmptyConnection.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="extract_ssh_parameters">
                            <input id="extract_ssh_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_ssh_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">profile</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="extract_ssh_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#extract_ssh_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extract_ssh_parameters-19"><a href="#extract_ssh_parameters-19"><span class="linenos">19</span></a><span class="k">def</span> <span class="nf">extract_ssh_parameters</span><span class="p">(</span><span class="n">profile</span><span class="p">):</span>
</span><span id="extract_ssh_parameters-20"><a href="#extract_ssh_parameters-20"><span class="linenos">20</span></a>	<span class="c1"># TODO: put a path profile, like mysql_connection</span>
</span><span id="extract_ssh_parameters-21"><a href="#extract_ssh_parameters-21"><span class="linenos">21</span></a>
</span><span id="extract_ssh_parameters-22"><a href="#extract_ssh_parameters-22"><span class="linenos">22</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="extract_ssh_parameters-23"><a href="#extract_ssh_parameters-23"><span class="linenos">23</span></a>
</span><span id="extract_ssh_parameters-24"><a href="#extract_ssh_parameters-24"><span class="linenos">24</span></a>	<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="extract_ssh_parameters-25"><a href="#extract_ssh_parameters-25"><span class="linenos">25</span></a>	<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span>
</span><span id="extract_ssh_parameters-26"><a href="#extract_ssh_parameters-26"><span class="linenos">26</span></a>	<span class="kn">import</span> <span class="nn">general_tools</span> <span class="k">as</span> <span class="nn">gt</span>
</span><span id="extract_ssh_parameters-27"><a href="#extract_ssh_parameters-27"><span class="linenos">27</span></a>	<span class="n">pouet</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)))</span>
</span><span id="extract_ssh_parameters-28"><a href="#extract_ssh_parameters-28"><span class="linenos">28</span></a>	<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jn</span><span class="p">(</span><span class="n">pouet</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="extract_ssh_parameters-29"><a href="#extract_ssh_parameters-29"><span class="linenos">29</span></a>	<span class="n">cred</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span>
</span><span id="extract_ssh_parameters-30"><a href="#extract_ssh_parameters-30"><span class="linenos">30</span></a>
</span><span id="extract_ssh_parameters-31"><a href="#extract_ssh_parameters-31"><span class="linenos">31</span></a>	<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
</span><span id="extract_ssh_parameters-32"><a href="#extract_ssh_parameters-32"><span class="linenos">32</span></a>	
</span><span id="extract_ssh_parameters-33"><a href="#extract_ssh_parameters-33"><span class="linenos">33</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ssh_tunnel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_tunnel&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_ssh_parameters-34"><a href="#extract_ssh_parameters-34"><span class="linenos">34</span></a>		<span class="k">if</span> <span class="s1">&#39;ssh_username&#39;</span> <span class="ow">in</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">():</span>
</span><span id="extract_ssh_parameters-35"><a href="#extract_ssh_parameters-35"><span class="linenos">35</span></a>			<span class="n">ssh_auth</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;ssh_auth&#39;</span><span class="p">)</span>
</span><span id="extract_ssh_parameters-36"><a href="#extract_ssh_parameters-36"><span class="linenos">36</span></a>			<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="extract_ssh_parameters-37"><a href="#extract_ssh_parameters-37"><span class="linenos">37</span></a>			<span class="k">if</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;password&#39;</span><span class="p">:</span>
</span><span id="extract_ssh_parameters-38"><a href="#extract_ssh_parameters-38"><span class="linenos">38</span></a>				<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="extract_ssh_parameters-39"><a href="#extract_ssh_parameters-39"><span class="linenos">39</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="extract_ssh_parameters-40"><a href="#extract_ssh_parameters-40"><span class="linenos">40</span></a>			<span class="k">elif</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;key&#39;</span><span class="p">:</span>
</span><span id="extract_ssh_parameters-41"><a href="#extract_ssh_parameters-41"><span class="linenos">41</span></a>				<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="extract_ssh_parameters-42"><a href="#extract_ssh_parameters-42"><span class="linenos">42</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="extract_ssh_parameters-43"><a href="#extract_ssh_parameters-43"><span class="linenos">43</span></a>				<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="extract_ssh_parameters-44"><a href="#extract_ssh_parameters-44"><span class="linenos">44</span></a>
</span><span id="extract_ssh_parameters-45"><a href="#extract_ssh_parameters-45"><span class="linenos">45</span></a>	<span class="k">return</span> <span class="n">kwargs</span>
</span></pre></div>


    

                </section>
                <section id="read_cred">
                            <input id="read_cred-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_cred</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">profile</span>, </span><span class="param"><span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_cred-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_cred"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_cred-48"><a href="#read_cred-48"><span class="linenos">48</span></a><span class="k">def</span> <span class="nf">read_cred</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="read_cred-49"><a href="#read_cred-49"><span class="linenos">49</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="read_cred-50"><a href="#read_cred-50"><span class="linenos">50</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="read_cred-51"><a href="#read_cred-51"><span class="linenos">51</span></a>
</span><span id="read_cred-52"><a href="#read_cred-52"><span class="linenos">52</span></a>	<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="read_cred-53"><a href="#read_cred-53"><span class="linenos">53</span></a>	<span class="k">if</span> <span class="n">path_profile</span>	<span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_cred-54"><a href="#read_cred-54"><span class="linenos">54</span></a>		<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="read_cred-55"><a href="#read_cred-55"><span class="linenos">55</span></a>		
</span><span id="read_cred-56"><a href="#read_cred-56"><span class="linenos">56</span></a>	<span class="n">pat</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_profile</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</span><span id="read_cred-57"><a href="#read_cred-57"><span class="linenos">57</span></a>	<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pat</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="read_cred-58"><a href="#read_cred-58"><span class="linenos">58</span></a>
</span><span id="read_cred-59"><a href="#read_cred-59"><span class="linenos">59</span></a>	<span class="k">return</span> <span class="n">cred</span>
</span></pre></div>


    

                </section>
                <section id="generic_connection">
                            <input id="generic_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">generic_connection</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">typ</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="generic_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#generic_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="generic_connection-62"><a href="#generic_connection-62"><span class="linenos">62</span></a><span class="nd">@contextmanager</span>
</span><span id="generic_connection-63"><a href="#generic_connection-63"><span class="linenos">63</span></a><span class="k">def</span> <span class="nf">generic_connection</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="generic_connection-64"><a href="#generic_connection-64"><span class="linenos">64</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="generic_connection-65"><a href="#generic_connection-65"><span class="linenos">65</span></a><span class="sd">	This a wrapper to uniformise remote (or local) connections for </span>
</span><span id="generic_connection-66"><a href="#generic_connection-66"><span class="linenos">66</span></a><span class="sd">	files and databases.</span>
</span><span id="generic_connection-67"><a href="#generic_connection-67"><span class="linenos">67</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="generic_connection-68"><a href="#generic_connection-68"><span class="linenos">68</span></a>	<span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="generic_connection-69"><a href="#generic_connection-69"><span class="linenos">69</span></a>		<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="n">path_profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="generic_connection-70"><a href="#generic_connection-70"><span class="linenos">70</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="generic_connection-71"><a href="#generic_connection-71"><span class="linenos">71</span></a>	<span class="k">elif</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">:</span>
</span><span id="generic_connection-72"><a href="#generic_connection-72"><span class="linenos">72</span></a>		<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="generic_connection-73"><a href="#generic_connection-73"><span class="linenos">73</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="generic_connection-74"><a href="#generic_connection-74"><span class="linenos">74</span></a>	<span class="k">elif</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="generic_connection-75"><a href="#generic_connection-75"><span class="linenos">75</span></a>		<span class="k">with</span> <span class="n">parquet_connection</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="generic_connection-76"><a href="#generic_connection-76"><span class="linenos">76</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span><span id="generic_connection-77"><a href="#generic_connection-77"><span class="linenos">77</span></a>	<span class="k">elif</span> <span class="n">typ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="generic_connection-78"><a href="#generic_connection-78"><span class="linenos">78</span></a>		<span class="k">yield</span> <span class="n">EmptyConnection</span><span class="p">()</span>
</span><span id="generic_connection-79"><a href="#generic_connection-79"><span class="linenos">79</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="generic_connection-80"><a href="#generic_connection-80"><span class="linenos">80</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Type of connection&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;is not supported.&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This a wrapper to uniformise remote (or local) connections for 
files and databases.</p>
</div>


                </section>
                <section id="mysql_connection">
                            <input id="mysql_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">mysql_connection</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mysql_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mysql_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mysql_connection-83"><a href="#mysql_connection-83"><span class="linenos"> 83</span></a><span class="nd">@contextmanager</span>
</span><span id="mysql_connection-84"><a href="#mysql_connection-84"><span class="linenos"> 84</span></a><span class="k">def</span> <span class="nf">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="mysql_connection-85"><a href="#mysql_connection-85"><span class="linenos"> 85</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="mysql_connection-86"><a href="#mysql_connection-86"><span class="linenos"> 86</span></a><span class="sd">	profile can be any string corresponding to a file &#39;db_profile_credentials.py&#39;</span>
</span><span id="mysql_connection-87"><a href="#mysql_connection-87"><span class="linenos"> 87</span></a>
</span><span id="mysql_connection-88"><a href="#mysql_connection-88"><span class="linenos"> 88</span></a><span class="sd">	profile is ignored if a non-None engine is passed in argument.</span>
</span><span id="mysql_connection-89"><a href="#mysql_connection-89"><span class="linenos"> 89</span></a>
</span><span id="mysql_connection-90"><a href="#mysql_connection-90"><span class="linenos"> 90</span></a><span class="sd">	Usage:</span>
</span><span id="mysql_connection-91"><a href="#mysql_connection-91"><span class="linenos"> 91</span></a>
</span><span id="mysql_connection-92"><a href="#mysql_connection-92"><span class="linenos"> 92</span></a><span class="sd">	mysql_connection(connection=something)</span>
</span><span id="mysql_connection-93"><a href="#mysql_connection-93"><span class="linenos"> 93</span></a><span class="sd">	-&gt; passes down connection. All other parameters are ignored.</span>
</span><span id="mysql_connection-94"><a href="#mysql_connection-94"><span class="linenos"> 94</span></a><span class="sd">	</span>
</span><span id="mysql_connection-95"><a href="#mysql_connection-95"><span class="linenos"> 95</span></a><span class="sd">	mysql_connection(profile=&#39;something&#39;) </span>
</span><span id="mysql_connection-96"><a href="#mysql_connection-96"><span class="linenos"> 96</span></a><span class="sd">	-&gt; opens connection with profile. All other parameters except connection are ignored.</span>
</span><span id="mysql_connection-97"><a href="#mysql_connection-97"><span class="linenos"> 97</span></a>
</span><span id="mysql_connection-98"><a href="#mysql_connection-98"><span class="linenos"> 98</span></a><span class="sd">	mysql_connection(username=..., password=...)</span>
</span><span id="mysql_connection-99"><a href="#mysql_connection-99"><span class="linenos"> 99</span></a><span class="sd">	-&gt; creates a connection with these parameters</span>
</span><span id="mysql_connection-100"><a href="#mysql_connection-100"><span class="linenos">100</span></a>
</span><span id="mysql_connection-101"><a href="#mysql_connection-101"><span class="linenos">101</span></a><span class="sd">	mysql_connection()</span>
</span><span id="mysql_connection-102"><a href="#mysql_connection-102"><span class="linenos">102</span></a><span class="sd">	-&gt; creates an empty connection {&#39;type&#39;:&#39;mysql&#39;, &#39;engine&#39;:None, &#39;ssh_tunnel&#39;:None}</span>
</span><span id="mysql_connection-103"><a href="#mysql_connection-103"><span class="linenos">103</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="mysql_connection-104"><a href="#mysql_connection-104"><span class="linenos">104</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="mysql_connection-105"><a href="#mysql_connection-105"><span class="linenos">105</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="mysql_connection-106"><a href="#mysql_connection-106"><span class="linenos">106</span></a>
</span><span id="mysql_connection-107"><a href="#mysql_connection-107"><span class="linenos">107</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mysql_connection-108"><a href="#mysql_connection-108"><span class="linenos">108</span></a>		<span class="k">yield</span> <span class="n">connection</span>
</span><span id="mysql_connection-109"><a href="#mysql_connection-109"><span class="linenos">109</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="mysql_connection-110"><a href="#mysql_connection-110"><span class="linenos">110</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mysql_connection-111"><a href="#mysql_connection-111"><span class="linenos">111</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;engine&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mysql_connection-112"><a href="#mysql_connection-112"><span class="linenos">112</span></a>				<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="mysql_connection-113"><a href="#mysql_connection-113"><span class="linenos">113</span></a>				<span class="k">if</span> <span class="n">path_profile</span>	<span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mysql_connection-114"><a href="#mysql_connection-114"><span class="linenos">114</span></a>					<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="mysql_connection-115"><a href="#mysql_connection-115"><span class="linenos">115</span></a>					
</span><span id="mysql_connection-116"><a href="#mysql_connection-116"><span class="linenos">116</span></a>				<span class="n">pat</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_profile</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</span><span id="mysql_connection-117"><a href="#mysql_connection-117"><span class="linenos">117</span></a>				
</span><span id="mysql_connection-118"><a href="#mysql_connection-118"><span class="linenos">118</span></a>				<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pat</span><span class="o">.</span><span class="n">resolve</span><span class="p">()))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="mysql_connection-119"><a href="#mysql_connection-119"><span class="linenos">119</span></a>
</span><span id="mysql_connection-120"><a href="#mysql_connection-120"><span class="linenos">120</span></a>				<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;database&#39;</span><span class="p">]:</span>
</span><span id="mysql_connection-121"><a href="#mysql_connection-121"><span class="linenos">121</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>
</span><span id="mysql_connection-122"><a href="#mysql_connection-122"><span class="linenos">122</span></a>				<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">)</span>
</span><span id="mysql_connection-123"><a href="#mysql_connection-123"><span class="linenos">123</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="mysql_connection-124"><a href="#mysql_connection-124"><span class="linenos">124</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;connector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;mysql_connector&#39;</span><span class="p">)</span>
</span><span id="mysql_connection-125"><a href="#mysql_connection-125"><span class="linenos">125</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="mysql_connection-126"><a href="#mysql_connection-126"><span class="linenos">126</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;connector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysqldb&#39;</span>
</span><span id="mysql_connection-127"><a href="#mysql_connection-127"><span class="linenos">127</span></a>
</span><span id="mysql_connection-128"><a href="#mysql_connection-128"><span class="linenos">128</span></a>				<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;DB connection to&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="mysql_connection-129"><a href="#mysql_connection-129"><span class="linenos">129</span></a>
</span><span id="mysql_connection-130"><a href="#mysql_connection-130"><span class="linenos">130</span></a>				<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;ssh_tunnel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_tunnel&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="mysql_connection-131"><a href="#mysql_connection-131"><span class="linenos">131</span></a>					<span class="k">if</span> <span class="s1">&#39;ssh_username&#39;</span> <span class="ow">in</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">():</span>
</span><span id="mysql_connection-132"><a href="#mysql_connection-132"><span class="linenos">132</span></a>						<span class="n">ssh_auth</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;ssh_auth&#39;</span><span class="p">)</span>
</span><span id="mysql_connection-133"><a href="#mysql_connection-133"><span class="linenos">133</span></a>						<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="mysql_connection-134"><a href="#mysql_connection-134"><span class="linenos">134</span></a>						<span class="k">if</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;password&#39;</span><span class="p">:</span>
</span><span id="mysql_connection-135"><a href="#mysql_connection-135"><span class="linenos">135</span></a>							<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="mysql_connection-136"><a href="#mysql_connection-136"><span class="linenos">136</span></a>								<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="mysql_connection-137"><a href="#mysql_connection-137"><span class="linenos">137</span></a>						<span class="k">elif</span> <span class="n">ssh_auth</span><span class="o">==</span><span class="s1">&#39;key&#39;</span><span class="p">:</span>
</span><span id="mysql_connection-138"><a href="#mysql_connection-138"><span class="linenos">138</span></a>							<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_hostname&#39;</span><span class="p">]:</span>
</span><span id="mysql_connection-139"><a href="#mysql_connection-139"><span class="linenos">139</span></a>								<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">))</span>	
</span><span id="mysql_connection-140"><a href="#mysql_connection-140"><span class="linenos">140</span></a>							<span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_agent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="mysql_connection-141"><a href="#mysql_connection-141"><span class="linenos">141</span></a>
</span><span id="mysql_connection-142"><a href="#mysql_connection-142"><span class="linenos">142</span></a>						<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;with ssh tunneling through&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ssh_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;ssh_hostname&#39;</span><span class="p">])</span>
</span><span id="mysql_connection-143"><a href="#mysql_connection-143"><span class="linenos">143</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="mysql_connection-144"><a href="#mysql_connection-144"><span class="linenos">144</span></a>						<span class="nb">print</span> <span class="p">()</span>
</span><span id="mysql_connection-145"><a href="#mysql_connection-145"><span class="linenos">145</span></a>		
</span><span id="mysql_connection-146"><a href="#mysql_connection-146"><span class="linenos">146</span></a>		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
</span><span id="mysql_connection-147"><a href="#mysql_connection-147"><span class="linenos">147</span></a>			<span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;engine&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ssh_tunnel&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
</span><span id="mysql_connection-148"><a href="#mysql_connection-148"><span class="linenos">148</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="mysql_connection-149"><a href="#mysql_connection-149"><span class="linenos">149</span></a>			<span class="k">with</span> <span class="n">mysql_server</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">mysql_connection</span><span class="p">:</span>
</span><span id="mysql_connection-150"><a href="#mysql_connection-150"><span class="linenos">150</span></a>				<span class="n">mysql_connection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
</span><span id="mysql_connection-151"><a href="#mysql_connection-151"><span class="linenos">151</span></a>				<span class="k">yield</span> <span class="n">mysql_connection</span>
</span></pre></div>


            <div class="docstring"><p>profile can be any string corresponding to a file 'db_profile_credentials.py'</p>

<p>profile is ignored if a non-None engine is passed in argument.</p>

<p>Usage:</p>

<p>mysql_connection(connection=something)
-> passes down connection. All other parameters are ignored.</p>

<p>mysql_connection(profile='something') 
-> opens connection with profile. All other parameters except connection are ignored.</p>

<p>mysql_connection(username=..., password=...)
-> creates a connection with these parameters</p>

<p>mysql_connection()
-> creates an empty connection {'type':'mysql', 'engine':None, 'ssh_tunnel':None}</p>
</div>


                </section>
                <section id="file_connection">
                            <input id="file_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">file_connection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">base_path</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="file_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#file_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="file_connection-154"><a href="#file_connection-154"><span class="linenos">154</span></a><span class="nd">@contextmanager</span>
</span><span id="file_connection-155"><a href="#file_connection-155"><span class="linenos">155</span></a><span class="k">def</span> <span class="nf">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="file_connection-156"><a href="#file_connection-156"><span class="linenos">156</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="file_connection-157"><a href="#file_connection-157"><span class="linenos">157</span></a><span class="sd">	To uniformise with mysql connection</span>
</span><span id="file_connection-158"><a href="#file_connection-158"><span class="linenos">158</span></a><span class="sd">	profile can be any string corresponding to a file &#39;db_profile_credentials.py&#39;</span>
</span><span id="file_connection-159"><a href="#file_connection-159"><span class="linenos">159</span></a>
</span><span id="file_connection-160"><a href="#file_connection-160"><span class="linenos">160</span></a><span class="sd">	profile is ignored if a non-None engine is passed in argument.</span>
</span><span id="file_connection-161"><a href="#file_connection-161"><span class="linenos">161</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="file_connection-162"><a href="#file_connection-162"><span class="linenos">162</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="file_connection-163"><a href="#file_connection-163"><span class="linenos">163</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="file_connection-164"><a href="#file_connection-164"><span class="linenos">164</span></a>
</span><span id="file_connection-165"><a href="#file_connection-165"><span class="linenos">165</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="file_connection-166"><a href="#file_connection-166"><span class="linenos">166</span></a>		<span class="k">yield</span> <span class="n">connection</span>
</span><span id="file_connection-167"><a href="#file_connection-167"><span class="linenos">167</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="file_connection-168"><a href="#file_connection-168"><span class="linenos">168</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="file_connection-169"><a href="#file_connection-169"><span class="linenos">169</span></a>			<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="file_connection-170"><a href="#file_connection-170"><span class="linenos">170</span></a>			<span class="k">if</span> <span class="n">path_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="file_connection-171"><a href="#file_connection-171"><span class="linenos">171</span></a>				<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="file_connection-172"><a href="#file_connection-172"><span class="linenos">172</span></a>			
</span><span id="file_connection-173"><a href="#file_connection-173"><span class="linenos">173</span></a>			<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jn</span><span class="p">(</span><span class="n">path_profile</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="file_connection-174"><a href="#file_connection-174"><span class="linenos">174</span></a>
</span><span id="file_connection-175"><a href="#file_connection-175"><span class="linenos">175</span></a>			<span class="k">if</span> <span class="n">base_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="file_connection-176"><a href="#file_connection-176"><span class="linenos">176</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="file_connection-177"><a href="#file_connection-177"><span class="linenos">177</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;base_path&#39;</span><span class="p">))</span>
</span><span id="file_connection-178"><a href="#file_connection-178"><span class="linenos">178</span></a>				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="file_connection-179"><a href="#file_connection-179"><span class="linenos">179</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="file_connection-180"><a href="#file_connection-180"><span class="linenos">180</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="file_connection-181"><a href="#file_connection-181"><span class="linenos">181</span></a>					<span class="k">raise</span>
</span><span id="file_connection-182"><a href="#file_connection-182"><span class="linenos">182</span></a>		
</span><span id="file_connection-183"><a href="#file_connection-183"><span class="linenos">183</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">profile</span><span class="o">!=</span><span class="s1">&#39;local&#39;</span><span class="p">:</span>
</span><span id="file_connection-184"><a href="#file_connection-184"><span class="linenos">184</span></a>
</span><span id="file_connection-185"><a href="#file_connection-185"><span class="linenos">185</span></a>			<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">]:</span>
</span><span id="file_connection-186"><a href="#file_connection-186"><span class="linenos">186</span></a>				<span class="k">if</span> <span class="ow">not</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
</span><span id="file_connection-187"><a href="#file_connection-187"><span class="linenos">187</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
</span><span id="file_connection-188"><a href="#file_connection-188"><span class="linenos">188</span></a>
</span><span id="file_connection-189"><a href="#file_connection-189"><span class="linenos">189</span></a>			<span class="k">with</span> <span class="n">ssh_client_connection</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh_connection</span><span class="p">:</span>
</span><span id="file_connection-190"><a href="#file_connection-190"><span class="linenos">190</span></a>				<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="n">ssh_connection</span><span class="p">,</span>
</span><span id="file_connection-191"><a href="#file_connection-191"><span class="linenos">191</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
</span><span id="file_connection-192"><a href="#file_connection-192"><span class="linenos">192</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="file_connection-193"><a href="#file_connection-193"><span class="linenos">193</span></a>				<span class="k">yield</span> <span class="n">connection</span>
</span><span id="file_connection-194"><a href="#file_connection-194"><span class="linenos">194</span></a>
</span><span id="file_connection-195"><a href="#file_connection-195"><span class="linenos">195</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="file_connection-196"><a href="#file_connection-196"><span class="linenos">196</span></a>			<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
</span><span id="file_connection-197"><a href="#file_connection-197"><span class="linenos">197</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
</span><span id="file_connection-198"><a href="#file_connection-198"><span class="linenos">198</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="file_connection-199"><a href="#file_connection-199"><span class="linenos">199</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span></pre></div>


            <div class="docstring"><p>To uniformise with mysql connection
profile can be any string corresponding to a file 'db_profile_credentials.py'</p>

<p>profile is ignored if a non-None engine is passed in argument.</p>
</div>


                </section>
                <section id="parquet_connection">
                            <input id="parquet_connection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@contextmanager</div>

        <span class="def">def</span>
        <span class="name">parquet_connection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">base_path</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parquet_connection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parquet_connection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parquet_connection-202"><a href="#parquet_connection-202"><span class="linenos">202</span></a><span class="nd">@contextmanager</span>
</span><span id="parquet_connection-203"><a href="#parquet_connection-203"><span class="linenos">203</span></a><span class="k">def</span> <span class="nf">parquet_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="parquet_connection-204"><a href="#parquet_connection-204"><span class="linenos">204</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="parquet_connection-205"><a href="#parquet_connection-205"><span class="linenos">205</span></a><span class="sd">	To uniformise with mysql connection</span>
</span><span id="parquet_connection-206"><a href="#parquet_connection-206"><span class="linenos">206</span></a><span class="sd">	profile can be any string corresponding to a file &#39;db_profile_credentials.py&#39;</span>
</span><span id="parquet_connection-207"><a href="#parquet_connection-207"><span class="linenos">207</span></a>
</span><span id="parquet_connection-208"><a href="#parquet_connection-208"><span class="linenos">208</span></a><span class="sd">	profile is ignored if a non-None engine is passed in argument.</span>
</span><span id="parquet_connection-209"><a href="#parquet_connection-209"><span class="linenos">209</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="parquet_connection-210"><a href="#parquet_connection-210"><span class="linenos">210</span></a>	<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
</span><span id="parquet_connection-211"><a href="#parquet_connection-211"><span class="linenos">211</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="parquet_connection-212"><a href="#parquet_connection-212"><span class="linenos">212</span></a>
</span><span id="parquet_connection-213"><a href="#parquet_connection-213"><span class="linenos">213</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parquet_connection-214"><a href="#parquet_connection-214"><span class="linenos">214</span></a>		<span class="k">yield</span> <span class="n">connection</span>
</span><span id="parquet_connection-215"><a href="#parquet_connection-215"><span class="linenos">215</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="parquet_connection-216"><a href="#parquet_connection-216"><span class="linenos">216</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parquet_connection-217"><a href="#parquet_connection-217"><span class="linenos">217</span></a>			<span class="n">name</span> <span class="o">=</span> <span class="n">profile</span> <span class="o">+</span> <span class="s1">&#39;_credentials&#39;</span>
</span><span id="parquet_connection-218"><a href="#parquet_connection-218"><span class="linenos">218</span></a>			<span class="k">if</span> <span class="n">path_profile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parquet_connection-219"><a href="#parquet_connection-219"><span class="linenos">219</span></a>				<span class="n">path_profile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="parquet_connection-220"><a href="#parquet_connection-220"><span class="linenos">220</span></a>
</span><span id="parquet_connection-221"><a href="#parquet_connection-221"><span class="linenos">221</span></a>			<span class="n">cred</span> <span class="o">=</span> <span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jn</span><span class="p">(</span><span class="n">path_profile</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load_module</span><span class="p">()</span>
</span><span id="parquet_connection-222"><a href="#parquet_connection-222"><span class="linenos">222</span></a>
</span><span id="parquet_connection-223"><a href="#parquet_connection-223"><span class="linenos">223</span></a>			<span class="k">if</span> <span class="n">base_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="parquet_connection-224"><a href="#parquet_connection-224"><span class="linenos">224</span></a>				<span class="k">try</span><span class="p">:</span>
</span><span id="parquet_connection-225"><a href="#parquet_connection-225"><span class="linenos">225</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="s1">&#39;base_path&#39;</span><span class="p">))</span>
</span><span id="parquet_connection-226"><a href="#parquet_connection-226"><span class="linenos">226</span></a>				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="parquet_connection-227"><a href="#parquet_connection-227"><span class="linenos">227</span></a>					<span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="parquet_connection-228"><a href="#parquet_connection-228"><span class="linenos">228</span></a>				<span class="k">except</span><span class="p">:</span>
</span><span id="parquet_connection-229"><a href="#parquet_connection-229"><span class="linenos">229</span></a>					<span class="k">raise</span>
</span><span id="parquet_connection-230"><a href="#parquet_connection-230"><span class="linenos">230</span></a>
</span><span id="parquet_connection-231"><a href="#parquet_connection-231"><span class="linenos">231</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">profile</span><span class="o">!=</span><span class="s1">&#39;local&#39;</span><span class="p">:</span>
</span><span id="parquet_connection-232"><a href="#parquet_connection-232"><span class="linenos">232</span></a>
</span><span id="parquet_connection-233"><a href="#parquet_connection-233"><span class="linenos">233</span></a>			<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ssh_hostname&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_username&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_password&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_pkey&#39;</span><span class="p">,</span> <span class="s1">&#39;ssh_key_password&#39;</span><span class="p">]:</span>
</span><span id="parquet_connection-234"><a href="#parquet_connection-234"><span class="linenos">234</span></a>				<span class="k">if</span> <span class="ow">not</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
</span><span id="parquet_connection-235"><a href="#parquet_connection-235"><span class="linenos">235</span></a>					<span class="n">kwargs</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">cred</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
</span><span id="parquet_connection-236"><a href="#parquet_connection-236"><span class="linenos">236</span></a>
</span><span id="parquet_connection-237"><a href="#parquet_connection-237"><span class="linenos">237</span></a>			<span class="k">with</span> <span class="n">ssh_client_connection</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssh_connection</span><span class="p">:</span>
</span><span id="parquet_connection-238"><a href="#parquet_connection-238"><span class="linenos">238</span></a>				<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="n">ssh_connection</span><span class="p">,</span>
</span><span id="parquet_connection-239"><a href="#parquet_connection-239"><span class="linenos">239</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;file&#39;</span><span class="p">,</span>
</span><span id="parquet_connection-240"><a href="#parquet_connection-240"><span class="linenos">240</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="parquet_connection-241"><a href="#parquet_connection-241"><span class="linenos">241</span></a>				<span class="k">yield</span> <span class="n">connection</span>
</span><span id="parquet_connection-242"><a href="#parquet_connection-242"><span class="linenos">242</span></a>
</span><span id="parquet_connection-243"><a href="#parquet_connection-243"><span class="linenos">243</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="parquet_connection-244"><a href="#parquet_connection-244"><span class="linenos">244</span></a>			<span class="n">connection</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span>
</span><span id="parquet_connection-245"><a href="#parquet_connection-245"><span class="linenos">245</span></a>							<span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;parquet&#39;</span><span class="p">,</span>
</span><span id="parquet_connection-246"><a href="#parquet_connection-246"><span class="linenos">246</span></a>							<span class="s1">&#39;base_path&#39;</span><span class="p">:</span><span class="n">base_path</span><span class="p">}</span>
</span><span id="parquet_connection-247"><a href="#parquet_connection-247"><span class="linenos">247</span></a>			<span class="k">yield</span> <span class="n">connection</span>
</span></pre></div>


            <div class="docstring"><p>To uniformise with mysql connection
profile can be any string corresponding to a file 'db_profile_credentials.py'</p>

<p>profile is ignored if a non-None engine is passed in argument.</p>
</div>


                </section>
                <section id="read_data">
                            <input id="read_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_data-250"><a href="#read_data-250"><span class="linenos">250</span></a><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="read_data-251"><a href="#read_data-251"><span class="linenos">251</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="read_data-252"><a href="#read_data-252"><span class="linenos">252</span></a><span class="sd">	Wrapper designed to have uniformed input reading. The connection[&#39;type&#39;] value determinates is the data should</span>
</span><span id="read_data-253"><a href="#read_data-253"><span class="linenos">253</span></a><span class="sd">	be read as mysql or files. The fmt option can point to the type of files read. If the value</span>
</span><span id="read_data-254"><a href="#read_data-254"><span class="linenos">254</span></a><span class="sd">	kwargs[&#39;file_name&#39;] is present, the type of file will be inferred based on the extension of the file name, otherwise</span>
</span><span id="read_data-255"><a href="#read_data-255"><span class="linenos">255</span></a><span class="sd">	it will be assumed that the format is parquet. One can specify the fmt option to make this explicit. Note that the</span>
</span><span id="read_data-256"><a href="#read_data-256"><span class="linenos">256</span></a><span class="sd">	parquet format is less general than others, and that a &#39;scenario&#39; key must be specified in kwargs.</span>
</span><span id="read_data-257"><a href="#read_data-257"><span class="linenos">257</span></a>
</span><span id="read_data-258"><a href="#read_data-258"><span class="linenos">258</span></a><span class="sd">	Parameters</span>
</span><span id="read_data-259"><a href="#read_data-259"><span class="linenos">259</span></a><span class="sd">	==========</span>
</span><span id="read_data-260"><a href="#read_data-260"><span class="linenos">260</span></a><span class="sd">	fmt: string</span>
</span><span id="read_data-261"><a href="#read_data-261"><span class="linenos">261</span></a><span class="sd">		either &#39;mysql&#39;, &#39;csv&#39;, &#39;pickle&#39;, or &#39;parquet&#39;</span>
</span><span id="read_data-262"><a href="#read_data-262"><span class="linenos">262</span></a><span class="sd">	connection: dictionary</span>
</span><span id="read_data-263"><a href="#read_data-263"><span class="linenos">263</span></a><span class="sd">		</span>
</span><span id="read_data-264"><a href="#read_data-264"><span class="linenos">264</span></a><span class="sd">	kwargs_mysql: dictionary</span>
</span><span id="read_data-265"><a href="#read_data-265"><span class="linenos">265</span></a><span class="sd">		additional key arguments to be passed to read_mysql.</span>
</span><span id="read_data-266"><a href="#read_data-266"><span class="linenos">266</span></a><span class="sd">		Put select=None and query=&#39;something&#39; to directly pass a query.</span>
</span><span id="read_data-267"><a href="#read_data-267"><span class="linenos">267</span></a>
</span><span id="read_data-268"><a href="#read_data-268"><span class="linenos">268</span></a><span class="sd">	Returns</span>
</span><span id="read_data-269"><a href="#read_data-269"><span class="linenos">269</span></a><span class="sd">	=======</span>
</span><span id="read_data-270"><a href="#read_data-270"><span class="linenos">270</span></a><span class="sd">	df: pandas Dataframe</span>
</span><span id="read_data-271"><a href="#read_data-271"><span class="linenos">271</span></a>
</span><span id="read_data-272"><a href="#read_data-272"><span class="linenos">272</span></a><span class="sd">	Note: automatic file format detection is not supported for parquet</span>
</span><span id="read_data-273"><a href="#read_data-273"><span class="linenos">273</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="read_data-274"><a href="#read_data-274"><span class="linenos">274</span></a>
</span><span id="read_data-275"><a href="#read_data-275"><span class="linenos">275</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_data-276"><a href="#read_data-276"><span class="linenos">276</span></a>		<span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="read_data-277"><a href="#read_data-277"><span class="linenos">277</span></a>			<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
</span><span id="read_data-278"><a href="#read_data-278"><span class="linenos">278</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-279"><a href="#read_data-279"><span class="linenos">279</span></a>			<span class="c1"># Automatic detection of format</span>
</span><span id="read_data-280"><a href="#read_data-280"><span class="linenos">280</span></a>			<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_data-281"><a href="#read_data-281"><span class="linenos">281</span></a>				<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="read_data-282"><a href="#read_data-282"><span class="linenos">282</span></a>					<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="read_data-283"><a href="#read_data-283"><span class="linenos">283</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="read_data-284"><a href="#read_data-284"><span class="linenos">284</span></a>					<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="read_data-285"><a href="#read_data-285"><span class="linenos">285</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="read_data-286"><a href="#read_data-286"><span class="linenos">286</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-287"><a href="#read_data-287"><span class="linenos">287</span></a>						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="read_data-288"><a href="#read_data-288"><span class="linenos">288</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-289"><a href="#read_data-289"><span class="linenos">289</span></a>					<span class="c1"># Assume the user wants parquet</span>
</span><span id="read_data-290"><a href="#read_data-290"><span class="linenos">290</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;parquet&#39;</span>
</span><span id="read_data-291"><a href="#read_data-291"><span class="linenos">291</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-292"><a href="#read_data-292"><span class="linenos">292</span></a>		<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_data-293"><a href="#read_data-293"><span class="linenos">293</span></a>			<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="read_data-294"><a href="#read_data-294"><span class="linenos">294</span></a>				<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="read_data-295"><a href="#read_data-295"><span class="linenos">295</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="read_data-296"><a href="#read_data-296"><span class="linenos">296</span></a>				<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="read_data-297"><a href="#read_data-297"><span class="linenos">297</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="read_data-298"><a href="#read_data-298"><span class="linenos">298</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-299"><a href="#read_data-299"><span class="linenos">299</span></a>					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="read_data-300"><a href="#read_data-300"><span class="linenos">300</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-301"><a href="#read_data-301"><span class="linenos">301</span></a>				<span class="c1"># Assume the user wants parquet</span>
</span><span id="read_data-302"><a href="#read_data-302"><span class="linenos">302</span></a>				<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;parquet&#39;</span>
</span><span id="read_data-303"><a href="#read_data-303"><span class="linenos">303</span></a>
</span><span id="read_data-304"><a href="#read_data-304"><span class="linenos">304</span></a>	<span class="k">if</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="read_data-305"><a href="#read_data-305"><span class="linenos">305</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_mysql</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="read_data-306"><a href="#read_data-306"><span class="linenos">306</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="read_data-307"><a href="#read_data-307"><span class="linenos">307</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="read_data-308"><a href="#read_data-308"><span class="linenos">308</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="read_data-309"><a href="#read_data-309"><span class="linenos">309</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_pickle</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="read_data-310"><a href="#read_data-310"><span class="linenos">310</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="read_data-311"><a href="#read_data-311"><span class="linenos">311</span></a>		<span class="n">df</span> <span class="o">=</span> <span class="n">read_parquet</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="read_data-312"><a href="#read_data-312"><span class="linenos">312</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="read_data-313"><a href="#read_data-313"><span class="linenos">313</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown format mode:&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
</span><span id="read_data-314"><a href="#read_data-314"><span class="linenos">314</span></a>
</span><span id="read_data-315"><a href="#read_data-315"><span class="linenos">315</span></a>	<span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper designed to have uniformed input reading. The connection['type'] value determinates is the data should
be read as mysql or files. The fmt option can point to the type of files read. If the value
kwargs['file_name'] is present, the type of file will be inferred based on the extension of the file name, otherwise
it will be assumed that the format is parquet. One can specify the fmt option to make this explicit. Note that the
parquet format is less general than others, and that a 'scenario' key must be specified in kwargs.</p>

<h1 id="parameters">Parameters</h1>

<p>fmt: string
        either 'mysql', 'csv', 'pickle', or 'parquet'
connection: dictionary</p>

<p>kwargs_mysql: dictionary
        additional key arguments to be passed to read_mysql.
        Put select=None and query='something' to directly pass a query.</p>

<h1 id="returns">Returns</h1>

<p>df: pandas Dataframe</p>

<p>Note: automatic file format detection is not supported for parquet</p>
</div>


                </section>
                <section id="read_csv">
                            <input id="read_csv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_csv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">other_paras</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_csv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_csv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_csv-318"><a href="#read_csv-318"><span class="linenos">318</span></a><span class="k">def</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">):</span>
</span><span id="read_csv-319"><a href="#read_csv-319"><span class="linenos">319</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="read_csv-320"><a href="#read_csv-320"><span class="linenos">320</span></a>
</span><span id="read_csv-321"><a href="#read_csv-321"><span class="linenos">321</span></a>	<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="read_csv-322"><a href="#read_csv-322"><span class="linenos">322</span></a>		<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="read_csv-323"><a href="#read_csv-323"><span class="linenos">323</span></a>		<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_csv-324"><a href="#read_csv-324"><span class="linenos">324</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="read_csv-325"><a href="#read_csv-325"><span class="linenos">325</span></a>
</span><span id="read_csv-326"><a href="#read_csv-326"><span class="linenos">326</span></a>		<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="read_csv-327"><a href="#read_csv-327"><span class="linenos">327</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_csv-328"><a href="#read_csv-328"><span class="linenos">328</span></a>			<span class="c1"># file is on a remote server, read it with sftp</span>
</span><span id="read_csv-329"><a href="#read_csv-329"><span class="linenos">329</span></a>			<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="read_csv-330"><a href="#read_csv-330"><span class="linenos">330</span></a>			<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">))</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="read_csv-331"><a href="#read_csv-331"><span class="linenos">331</span></a>				<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">remote_file</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="read_csv-332"><a href="#read_csv-332"><span class="linenos">332</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="read_csv-333"><a href="#read_csv-333"><span class="linenos">333</span></a>			<span class="c1"># file is local, read it directly.</span>
</span><span id="read_csv-334"><a href="#read_csv-334"><span class="linenos">334</span></a>			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="read_csv-335"><a href="#read_csv-335"><span class="linenos">335</span></a>
</span><span id="read_csv-336"><a href="#read_csv-336"><span class="linenos">336</span></a>	<span class="k">return</span> <span class="n">df</span>
</span></pre></div>


    

                </section>
                <section id="do_query">
                            <input id="do_query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">do_query</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sql</span>, </span><span class="param"><span class="n">con</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="do_query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#do_query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="do_query-339"><a href="#do_query-339"><span class="linenos">339</span></a><span class="k">def</span> <span class="nf">do_query</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="p">):</span>
</span><span id="do_query-340"><a href="#do_query-340"><span class="linenos">340</span></a>	<span class="c1"># This section is required, otherwise the execute part below fails...</span>
</span><span id="do_query-341"><a href="#do_query-341"><span class="linenos">341</span></a>	<span class="k">try</span><span class="p">:</span>
</span><span id="do_query-342"><a href="#do_query-342"><span class="linenos">342</span></a>		<span class="n">con</span><span class="o">.</span><span class="n">run_callable</span><span class="p">(</span>
</span><span id="do_query-343"><a href="#do_query-343"><span class="linenos">343</span></a>			<span class="n">con</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">has_table</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="do_query-344"><a href="#do_query-344"><span class="linenos">344</span></a>		<span class="p">)</span>
</span><span id="do_query-345"><a href="#do_query-345"><span class="linenos">345</span></a>	<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="do_query-346"><a href="#do_query-346"><span class="linenos">346</span></a>		<span class="c1"># using generic exception to catch errors from sql drivers (GH24988)</span>
</span><span id="do_query-347"><a href="#do_query-347"><span class="linenos">347</span></a>		<span class="n">_is_table_name</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="do_query-348"><a href="#do_query-348"><span class="linenos">348</span></a>
</span><span id="do_query-349"><a href="#do_query-349"><span class="linenos">349</span></a>	<span class="n">rs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="do_query-350"><a href="#do_query-350"><span class="linenos">350</span></a>
</span><span id="do_query-351"><a href="#do_query-351"><span class="linenos">351</span></a>	<span class="k">return</span> <span class="n">rs</span>
</span></pre></div>


    

                </section>
                <section id="run_mysql_query">
                            <input id="run_mysql_query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_mysql_query</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">query</span>, </span><span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="run_mysql_query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#run_mysql_query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="run_mysql_query-354"><a href="#run_mysql_query-354"><span class="linenos">354</span></a><span class="k">def</span> <span class="nf">run_mysql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="run_mysql_query-355"><a href="#run_mysql_query-355"><span class="linenos">355</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="run_mysql_query-356"><a href="#run_mysql_query-356"><span class="linenos">356</span></a><span class="sd">	This function whould be used only for queries that do not return data, e.g. table creation.</span>
</span><span id="run_mysql_query-357"><a href="#run_mysql_query-357"><span class="linenos">357</span></a><span class="sd">	Indeed, the output of the function is unstructured, on the contrary of read_mysql</span>
</span><span id="run_mysql_query-358"><a href="#run_mysql_query-358"><span class="linenos">358</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="run_mysql_query-359"><a href="#run_mysql_query-359"><span class="linenos">359</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="run_mysql_query-360"><a href="#run_mysql_query-360"><span class="linenos">360</span></a>		<span class="n">engine</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
</span><span id="run_mysql_query-361"><a href="#run_mysql_query-361"><span class="linenos">361</span></a>
</span><span id="run_mysql_query-362"><a href="#run_mysql_query-362"><span class="linenos">362</span></a>		<span class="n">rs</span> <span class="o">=</span> <span class="n">do_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="run_mysql_query-363"><a href="#run_mysql_query-363"><span class="linenos">363</span></a>
</span><span id="run_mysql_query-364"><a href="#run_mysql_query-364"><span class="linenos">364</span></a>	<span class="k">return</span> <span class="n">rs</span>
</span></pre></div>


            <div class="docstring"><p>This function whould be used only for queries that do not return data, e.g. table creation.
Indeed, the output of the function is unstructured, on the contrary of read_mysql</p>
</div>


                </section>
                <section id="read_pickle">
                            <input id="read_pickle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_pickle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">byte</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">garbage</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_pickle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_pickle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_pickle-367"><a href="#read_pickle-367"><span class="linenos">367</span></a><span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">byte</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">garbage</span><span class="p">):</span>
</span><span id="read_pickle-368"><a href="#read_pickle-368"><span class="linenos">368</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="read_pickle-369"><a href="#read_pickle-369"><span class="linenos">369</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="read_pickle-370"><a href="#read_pickle-370"><span class="linenos">370</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="read_pickle-371"><a href="#read_pickle-371"><span class="linenos">371</span></a>	<span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="read_pickle-372"><a href="#read_pickle-372"><span class="linenos">372</span></a>
</span><span id="read_pickle-373"><a href="#read_pickle-373"><span class="linenos">373</span></a>	<span class="k">if</span> <span class="n">byte</span><span class="p">:</span>
</span><span id="read_pickle-374"><a href="#read_pickle-374"><span class="linenos">374</span></a>		<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span>
</span><span id="read_pickle-375"><a href="#read_pickle-375"><span class="linenos">375</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="read_pickle-376"><a href="#read_pickle-376"><span class="linenos">376</span></a>		<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
</span><span id="read_pickle-377"><a href="#read_pickle-377"><span class="linenos">377</span></a>
</span><span id="read_pickle-378"><a href="#read_pickle-378"><span class="linenos">378</span></a>	<span class="c1"># if profile is None:</span>
</span><span id="read_pickle-379"><a href="#read_pickle-379"><span class="linenos">379</span></a>	<span class="c1"># 	profile = &#39;local&#39;</span>
</span><span id="read_pickle-380"><a href="#read_pickle-380"><span class="linenos">380</span></a>
</span><span id="read_pickle-381"><a href="#read_pickle-381"><span class="linenos">381</span></a>	<span class="c1">#print (connection)</span>
</span><span id="read_pickle-382"><a href="#read_pickle-382"><span class="linenos">382</span></a>	<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="read_pickle-383"><a href="#read_pickle-383"><span class="linenos">383</span></a>		<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="read_pickle-384"><a href="#read_pickle-384"><span class="linenos">384</span></a>		<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_pickle-385"><a href="#read_pickle-385"><span class="linenos">385</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="read_pickle-386"><a href="#read_pickle-386"><span class="linenos">386</span></a>
</span><span id="read_pickle-387"><a href="#read_pickle-387"><span class="linenos">387</span></a>		<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="read_pickle-388"><a href="#read_pickle-388"><span class="linenos">388</span></a>		<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_pickle-389"><a href="#read_pickle-389"><span class="linenos">389</span></a>			<span class="c1"># file is on a remote server, read it with sftp</span>
</span><span id="read_pickle-390"><a href="#read_pickle-390"><span class="linenos">390</span></a>			<span class="c1"># folder creation on remote server.</span>
</span><span id="read_pickle-391"><a href="#read_pickle-391"><span class="linenos">391</span></a>			<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="read_pickle-392"><a href="#read_pickle-392"><span class="linenos">392</span></a>			<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">))</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="read_pickle-393"><a href="#read_pickle-393"><span class="linenos">393</span></a>				<span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">remote_file</span><span class="p">)</span>
</span><span id="read_pickle-394"><a href="#read_pickle-394"><span class="linenos">394</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="read_pickle-395"><a href="#read_pickle-395"><span class="linenos">395</span></a>			<span class="c1"># file is local, read it directly.</span>
</span><span id="read_pickle-396"><a href="#read_pickle-396"><span class="linenos">396</span></a>
</span><span id="read_pickle-397"><a href="#read_pickle-397"><span class="linenos">397</span></a>			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="read_pickle-398"><a href="#read_pickle-398"><span class="linenos">398</span></a>				<span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="read_pickle-399"><a href="#read_pickle-399"><span class="linenos">399</span></a>			
</span><span id="read_pickle-400"><a href="#read_pickle-400"><span class="linenos">400</span></a>	<span class="k">return</span> <span class="n">df</span>
</span></pre></div>


    

                </section>
                <section id="read_parquet">
                            <input id="read_parquet-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_parquet</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">scenario</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">query</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">garbage</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_parquet-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_parquet"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_parquet-403"><a href="#read_parquet-403"><span class="linenos">403</span></a><span class="k">def</span> <span class="nf">read_parquet</span><span class="p">(</span><span class="n">scenario</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">garbage</span><span class="p">):</span>
</span><span id="read_parquet-404"><a href="#read_parquet-404"><span class="linenos">404</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="read_parquet-405"><a href="#read_parquet-405"><span class="linenos">405</span></a><span class="sd">	This function allows to read parquets files like an SQL database, by providing an SQL query. The query is</span>
</span><span id="read_parquet-406"><a href="#read_parquet-406"><span class="linenos">406</span></a><span class="sd">	automatically cnverted to a format to be read with duckdb.</span>
</span><span id="read_parquet-407"><a href="#read_parquet-407"><span class="linenos">407</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="read_parquet-408"><a href="#read_parquet-408"><span class="linenos">408</span></a>
</span><span id="read_parquet-409"><a href="#read_parquet-409"><span class="linenos">409</span></a>	<span class="c1"># TODO: add ssh support and profile input</span>
</span><span id="read_parquet-410"><a href="#read_parquet-410"><span class="linenos">410</span></a>	<span class="kn">import</span> <span class="nn">duckdb</span>
</span><span id="read_parquet-411"><a href="#read_parquet-411"><span class="linenos">411</span></a>	<span class="c1">#duckdb.load_extension(&#39;spatial&#39;)s</span>
</span><span id="read_parquet-412"><a href="#read_parquet-412"><span class="linenos">412</span></a>
</span><span id="read_parquet-413"><a href="#read_parquet-413"><span class="linenos">413</span></a>	<span class="n">sql</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="read_parquet-414"><a href="#read_parquet-414"><span class="linenos">414</span></a>	<span class="n">convert_next_word</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="read_parquet-415"><a href="#read_parquet-415"><span class="linenos">415</span></a>	<span class="n">words</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="read_parquet-416"><a href="#read_parquet-416"><span class="linenos">416</span></a>	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="read_parquet-417"><a href="#read_parquet-417"><span class="linenos">417</span></a>		<span class="n">word_stripped</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="read_parquet-418"><a href="#read_parquet-418"><span class="linenos">418</span></a>
</span><span id="read_parquet-419"><a href="#read_parquet-419"><span class="linenos">419</span></a>		<span class="k">if</span> <span class="n">convert_next_word</span><span class="p">:</span>
</span><span id="read_parquet-420"><a href="#read_parquet-420"><span class="linenos">420</span></a>			<span class="n">w</span> <span class="o">=</span> <span class="s2">&quot;read_parquet(&#39;</span><span class="si">{}</span><span class="s2">.parquet&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;scenario=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scenario</span><span class="p">))</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">word_stripped</span><span class="p">))</span>
</span><span id="read_parquet-421"><a href="#read_parquet-421"><span class="linenos">421</span></a>			<span class="n">convert_next_word</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="read_parquet-422"><a href="#read_parquet-422"><span class="linenos">422</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="read_parquet-423"><a href="#read_parquet-423"><span class="linenos">423</span></a>			<span class="n">w</span> <span class="o">=</span> <span class="n">word_stripped</span>
</span><span id="read_parquet-424"><a href="#read_parquet-424"><span class="linenos">424</span></a>
</span><span id="read_parquet-425"><a href="#read_parquet-425"><span class="linenos">425</span></a>		<span class="k">if</span> <span class="n">word_stripped</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="s1">&#39;JOIN&#39;</span><span class="p">]:</span>
</span><span id="read_parquet-426"><a href="#read_parquet-426"><span class="linenos">426</span></a>			<span class="c1"># test if join in something like join (select ...)</span>
</span><span id="read_parquet-427"><a href="#read_parquet-427"><span class="linenos">427</span></a>			<span class="n">next_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="read_parquet-428"><a href="#read_parquet-428"><span class="linenos">428</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">next_word</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(s&#39;</span> <span class="ow">or</span> <span class="n">next_word</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;( s&#39;</span><span class="p">):</span>
</span><span id="read_parquet-429"><a href="#read_parquet-429"><span class="linenos">429</span></a>				<span class="n">convert_next_word</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="read_parquet-430"><a href="#read_parquet-430"><span class="linenos">430</span></a>
</span><span id="read_parquet-431"><a href="#read_parquet-431"><span class="linenos">431</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
</span><span id="read_parquet-432"><a href="#read_parquet-432"><span class="linenos">432</span></a>
</span><span id="read_parquet-433"><a href="#read_parquet-433"><span class="linenos">433</span></a>	<span class="n">df</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</span><span id="read_parquet-434"><a href="#read_parquet-434"><span class="linenos">434</span></a>
</span><span id="read_parquet-435"><a href="#read_parquet-435"><span class="linenos">435</span></a>	<span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>This function allows to read parquets files like an SQL database, by providing an SQL query. The query is
automatically cnverted to a format to be read with duckdb.</p>
</div>


                </section>
                <section id="read_mysql">
                            <input id="read_mysql-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_mysql</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">select</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fromm</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">conditions</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">query</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">index_col</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">options</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_mysql-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_mysql"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_mysql-438"><a href="#read_mysql-438"><span class="linenos">438</span></a><span class="k">def</span> <span class="nf">read_mysql</span><span class="p">(</span><span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fromm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="p">{},</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
</span><span id="read_mysql-439"><a href="#read_mysql-439"><span class="linenos">439</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="read_mysql-440"><a href="#read_mysql-440"><span class="linenos">440</span></a><span class="sd">	Read something from sql. &#39;select&#39;, &#39;fromm&#39;, and &#39;conditions&#39; can be used for quick and dirty queries, but more </span>
</span><span id="read_mysql-441"><a href="#read_mysql-441"><span class="linenos">441</span></a><span class="sd">	complex ones should be done with &#39;query&#39; directly by setting &#39;select&#39; to` &#39;None&#39;</span>
</span><span id="read_mysql-442"><a href="#read_mysql-442"><span class="linenos">442</span></a>
</span><span id="read_mysql-443"><a href="#read_mysql-443"><span class="linenos">443</span></a><span class="sd">	Parameters</span>
</span><span id="read_mysql-444"><a href="#read_mysql-444"><span class="linenos">444</span></a><span class="sd">	==========</span>
</span><span id="read_mysql-445"><a href="#read_mysql-445"><span class="linenos">445</span></a><span class="sd">	select: list of string</span>
</span><span id="read_mysql-446"><a href="#read_mysql-446"><span class="linenos">446</span></a><span class="sd">		name of attribute to get. If None, set to &#39;*&#39;. Ignored if query is not None.</span>
</span><span id="read_mysql-447"><a href="#read_mysql-447"><span class="linenos">447</span></a><span class="sd">	fromm: string</span>
</span><span id="read_mysql-448"><a href="#read_mysql-448"><span class="linenos">448</span></a><span class="sd">		table name to query. Ignored if query is not None.</span>
</span><span id="read_mysql-449"><a href="#read_mysql-449"><span class="linenos">449</span></a><span class="sd">	conditions: dictionnary</span>
</span><span id="read_mysql-450"><a href="#read_mysql-450"><span class="linenos">450</span></a><span class="sd">		keys are name of attributes and values are values to be matched by the attributes.</span>
</span><span id="read_mysql-451"><a href="#read_mysql-451"><span class="linenos">451</span></a><span class="sd">		Ignored if query is not None.</span>
</span><span id="read_mysql-452"><a href="#read_mysql-452"><span class="linenos">452</span></a><span class="sd">	query: string</span>
</span><span id="read_mysql-453"><a href="#read_mysql-453"><span class="linenos">453</span></a><span class="sd">		full query for the database. If None, attributes &#39;select&#39;, &#39;fromm&#39; and &#39;conditions&#39; are used.</span>
</span><span id="read_mysql-454"><a href="#read_mysql-454"><span class="linenos">454</span></a><span class="sd">	engine: sqlalchemy engine object</span>
</span><span id="read_mysql-455"><a href="#read_mysql-455"><span class="linenos">455</span></a><span class="sd">		If given then it is used to do the connection,</span>
</span><span id="read_mysql-456"><a href="#read_mysql-456"><span class="linenos">456</span></a><span class="sd">		if missing then it is created based on user, password, address and</span>
</span><span id="read_mysql-457"><a href="#read_mysql-457"><span class="linenos">457</span></a><span class="sd">		db_name from db_connection</span>
</span><span id="read_mysql-458"><a href="#read_mysql-458"><span class="linenos">458</span></a><span class="sd">	options: dictionnary</span>
</span><span id="read_mysql-459"><a href="#read_mysql-459"><span class="linenos">459</span></a><span class="sd">		options to be passed on to the sqlalchemy engine.</span>
</span><span id="read_mysql-460"><a href="#read_mysql-460"><span class="linenos">460</span></a>
</span><span id="read_mysql-461"><a href="#read_mysql-461"><span class="linenos">461</span></a><span class="sd">	Returns</span>
</span><span id="read_mysql-462"><a href="#read_mysql-462"><span class="linenos">462</span></a><span class="sd">	=======</span>
</span><span id="read_mysql-463"><a href="#read_mysql-463"><span class="linenos">463</span></a><span class="sd">	df: pandas Dataframe</span>
</span><span id="read_mysql-464"><a href="#read_mysql-464"><span class="linenos">464</span></a><span class="sd">		with results</span>
</span><span id="read_mysql-465"><a href="#read_mysql-465"><span class="linenos">465</span></a>
</span><span id="read_mysql-466"><a href="#read_mysql-466"><span class="linenos">466</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="read_mysql-467"><a href="#read_mysql-467"><span class="linenos">467</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="read_mysql-468"><a href="#read_mysql-468"><span class="linenos">468</span></a>		<span class="n">engine</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
</span><span id="read_mysql-469"><a href="#read_mysql-469"><span class="linenos">469</span></a>		<span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_mysql-470"><a href="#read_mysql-470"><span class="linenos">470</span></a>			<span class="k">assert</span> <span class="ow">not</span> <span class="n">fromm</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="read_mysql-471"><a href="#read_mysql-471"><span class="linenos">471</span></a>			<span class="k">if</span> <span class="n">select</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_mysql-472"><a href="#read_mysql-472"><span class="linenos">472</span></a>				<span class="n">select</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span> 
</span><span id="read_mysql-473"><a href="#read_mysql-473"><span class="linenos">473</span></a>			<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">select</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span>
</span><span id="read_mysql-474"><a href="#read_mysql-474"><span class="linenos">474</span></a>				<span class="n">select_new</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="read_mysql-475"><a href="#read_mysql-475"><span class="linenos">475</span></a>				<span class="k">for</span> <span class="n">stuff</span> <span class="ow">in</span> <span class="n">select</span><span class="p">:</span>
</span><span id="read_mysql-476"><a href="#read_mysql-476"><span class="linenos">476</span></a>					<span class="n">select_new</span> <span class="o">+=</span> <span class="n">stuff</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span>
</span><span id="read_mysql-477"><a href="#read_mysql-477"><span class="linenos">477</span></a>				<span class="n">select</span> <span class="o">=</span> <span class="n">select_new</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="read_mysql-478"><a href="#read_mysql-478"><span class="linenos">478</span></a>			<span class="k">elif</span> <span class="n">select</span><span class="o">==</span><span class="s1">&#39;*&#39;</span><span class="p">:</span>
</span><span id="read_mysql-479"><a href="#read_mysql-479"><span class="linenos">479</span></a>				<span class="k">pass</span>
</span><span id="read_mysql-480"><a href="#read_mysql-480"><span class="linenos">480</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="read_mysql-481"><a href="#read_mysql-481"><span class="linenos">481</span></a>				<span class="k">pass</span>
</span><span id="read_mysql-482"><a href="#read_mysql-482"><span class="linenos">482</span></a>				<span class="c1">#raise Exception()</span>
</span><span id="read_mysql-483"><a href="#read_mysql-483"><span class="linenos">483</span></a>
</span><span id="read_mysql-484"><a href="#read_mysql-484"><span class="linenos">484</span></a>			<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT &#39;</span> <span class="o">+</span> <span class="n">select</span> <span class="o">+</span> <span class="s1">&#39; FROM &#39;</span> <span class="o">+</span> <span class="n">fromm</span> <span class="o">+</span> <span class="s1">&#39; WHERE &#39;</span>
</span><span id="read_mysql-485"><a href="#read_mysql-485"><span class="linenos">485</span></a>			<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="read_mysql-486"><a href="#read_mysql-486"><span class="linenos">486</span></a>				<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="read_mysql-487"><a href="#read_mysql-487"><span class="linenos">487</span></a>					<span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span id="read_mysql-488"><a href="#read_mysql-488"><span class="linenos">488</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="read_mysql-489"><a href="#read_mysql-489"><span class="linenos">489</span></a>					<span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="read_mysql-490"><a href="#read_mysql-490"><span class="linenos">490</span></a>				<span class="n">query</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span>
</span><span id="read_mysql-491"><a href="#read_mysql-491"><span class="linenos">491</span></a>
</span><span id="read_mysql-492"><a href="#read_mysql-492"><span class="linenos">492</span></a>			<span class="k">if</span> <span class="n">conditions</span><span class="o">==</span><span class="p">{}:</span>
</span><span id="read_mysql-493"><a href="#read_mysql-493"><span class="linenos">493</span></a>				<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
</span><span id="read_mysql-494"><a href="#read_mysql-494"><span class="linenos">494</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="read_mysql-495"><a href="#read_mysql-495"><span class="linenos">495</span></a>				<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
</span><span id="read_mysql-496"><a href="#read_mysql-496"><span class="linenos">496</span></a>
</span><span id="read_mysql-497"><a href="#read_mysql-497"><span class="linenos">497</span></a>
</span><span id="read_mysql-498"><a href="#read_mysql-498"><span class="linenos">498</span></a>		<span class="k">if</span> <span class="n">index_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="read_mysql-499"><a href="#read_mysql-499"><span class="linenos">499</span></a>			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="read_mysql-500"><a href="#read_mysql-500"><span class="linenos">500</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="read_mysql-501"><a href="#read_mysql-501"><span class="linenos">501</span></a>			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="read_mysql-502"><a href="#read_mysql-502"><span class="linenos">502</span></a>
</span><span id="read_mysql-503"><a href="#read_mysql-503"><span class="linenos">503</span></a>		<span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Read something from sql. 'select', 'fromm', and 'conditions' can be used for quick and dirty queries, but more 
complex ones should be done with 'query' directly by setting 'select' to` 'None'</p>

<h1 id="parameters">Parameters</h1>

<p>select: list of string
        name of attribute to get. If None, set to '*'. Ignored if query is not None.
fromm: string
        table name to query. Ignored if query is not None.
conditions: dictionnary
        keys are name of attributes and values are values to be matched by the attributes.
        Ignored if query is not None.
query: string
        full query for the database. If None, attributes 'select', 'fromm' and 'conditions' are used.
engine: sqlalchemy engine object
        If given then it is used to do the connection,
        if missing then it is created based on user, password, address and
        db_name from db_connection
options: dictionnary
        options to be passed on to the sqlalchemy engine.</p>

<h1 id="returns">Returns</h1>

<p>df: pandas Dataframe
        with results</p>
</div>


                </section>
                <section id="write_data">
                            <input id="write_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">connection</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">profile</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="write_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#write_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="write_data-505"><a href="#write_data-505"><span class="linenos">505</span></a><span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="write_data-506"><a href="#write_data-506"><span class="linenos">506</span></a>
</span><span id="write_data-507"><a href="#write_data-507"><span class="linenos">507</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="write_data-508"><a href="#write_data-508"><span class="linenos">508</span></a><span class="sd">	Wrapper designed to have uniformed input writing.</span>
</span><span id="write_data-509"><a href="#write_data-509"><span class="linenos">509</span></a>
</span><span id="write_data-510"><a href="#write_data-510"><span class="linenos">510</span></a><span class="sd">	Parameters</span>
</span><span id="write_data-511"><a href="#write_data-511"><span class="linenos">511</span></a><span class="sd">	==========</span>
</span><span id="write_data-512"><a href="#write_data-512"><span class="linenos">512</span></a><span class="sd">	what: pandas Dataframe object,</span>
</span><span id="write_data-513"><a href="#write_data-513"><span class="linenos">513</span></a><span class="sd">		to be written</span>
</span><span id="write_data-514"><a href="#write_data-514"><span class="linenos">514</span></a><span class="sd">	where: string,</span>
</span><span id="write_data-515"><a href="#write_data-515"><span class="linenos">515</span></a><span class="sd">		name of file to get the data from if which=&#39;csv&#39; or &#39;pickle&#39;.</span>
</span><span id="write_data-516"><a href="#write_data-516"><span class="linenos">516</span></a><span class="sd">		Name of table otherwise.</span>
</span><span id="write_data-517"><a href="#write_data-517"><span class="linenos">517</span></a><span class="sd">	how: string,</span>
</span><span id="write_data-518"><a href="#write_data-518"><span class="linenos">518</span></a><span class="sd">		either &#39;update&#39;, &#39;replace&#39;, or &#39;append&#39;. Define how the data should be added.</span>
</span><span id="write_data-519"><a href="#write_data-519"><span class="linenos">519</span></a><span class="sd">		&#39;update&#39; only works with &#39;mysql&#39; right now.</span>
</span><span id="write_data-520"><a href="#write_data-520"><span class="linenos">520</span></a><span class="sd">	which: string,</span>
</span><span id="write_data-521"><a href="#write_data-521"><span class="linenos">521</span></a><span class="sd">		either &#39;mysql&#39;, &#39;csv&#39;, or &#39;pickle&#39;.</span>
</span><span id="write_data-522"><a href="#write_data-522"><span class="linenos">522</span></a><span class="sd">	kwargs_mysql: dictionary</span>
</span><span id="write_data-523"><a href="#write_data-523"><span class="linenos">523</span></a><span class="sd">		additional key arguments to be passed to write_sql.</span>
</span><span id="write_data-524"><a href="#write_data-524"><span class="linenos">524</span></a>
</span><span id="write_data-525"><a href="#write_data-525"><span class="linenos">525</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="write_data-526"><a href="#write_data-526"><span class="linenos">526</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_data-527"><a href="#write_data-527"><span class="linenos">527</span></a>		<span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="write_data-528"><a href="#write_data-528"><span class="linenos">528</span></a>			<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span>
</span><span id="write_data-529"><a href="#write_data-529"><span class="linenos">529</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="write_data-530"><a href="#write_data-530"><span class="linenos">530</span></a>			<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_data-531"><a href="#write_data-531"><span class="linenos">531</span></a>				<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="write_data-532"><a href="#write_data-532"><span class="linenos">532</span></a>					<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="write_data-533"><a href="#write_data-533"><span class="linenos">533</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="write_data-534"><a href="#write_data-534"><span class="linenos">534</span></a>					<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="write_data-535"><a href="#write_data-535"><span class="linenos">535</span></a>						<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="write_data-536"><a href="#write_data-536"><span class="linenos">536</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="write_data-537"><a href="#write_data-537"><span class="linenos">537</span></a>						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="write_data-538"><a href="#write_data-538"><span class="linenos">538</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="write_data-539"><a href="#write_data-539"><span class="linenos">539</span></a>		<span class="k">if</span> <span class="n">fmt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_data-540"><a href="#write_data-540"><span class="linenos">540</span></a>			<span class="k">if</span> <span class="s1">&#39;file_name&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="write_data-541"><a href="#write_data-541"><span class="linenos">541</span></a>				<span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="write_data-542"><a href="#write_data-542"><span class="linenos">542</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;csv&#39;</span>
</span><span id="write_data-543"><a href="#write_data-543"><span class="linenos">543</span></a>				<span class="k">elif</span> <span class="s1">&#39;.pic&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">]:</span>
</span><span id="write_data-544"><a href="#write_data-544"><span class="linenos">544</span></a>					<span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;pickle&#39;</span>
</span><span id="write_data-545"><a href="#write_data-545"><span class="linenos">545</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="write_data-546"><a href="#write_data-546"><span class="linenos">546</span></a>					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;I could not guess the data format for&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">],</span> <span class="s1">&#39;you need to pass it manually with fmt=&#39;</span><span class="p">)</span>
</span><span id="write_data-547"><a href="#write_data-547"><span class="linenos">547</span></a>
</span><span id="write_data-548"><a href="#write_data-548"><span class="linenos">548</span></a>	<span class="k">if</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span><span id="write_data-549"><a href="#write_data-549"><span class="linenos">549</span></a>		<span class="n">write_mysql</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="write_data-550"><a href="#write_data-550"><span class="linenos">550</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="write_data-551"><a href="#write_data-551"><span class="linenos">551</span></a>		<span class="n">write_csv</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="write_data-552"><a href="#write_data-552"><span class="linenos">552</span></a>	<span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
</span><span id="write_data-553"><a href="#write_data-553"><span class="linenos">553</span></a>		<span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="write_data-554"><a href="#write_data-554"><span class="linenos">554</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="write_data-555"><a href="#write_data-555"><span class="linenos">555</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown format mode:&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper designed to have uniformed input writing.</p>

<h1 id="parameters">Parameters</h1>

<p>what: pandas Dataframe object,
        to be written
where: string,
        name of file to get the data from if which='csv' or 'pickle'.
        Name of table otherwise.
how: string,
        either 'update', 'replace', or 'append'. Define how the data should be added.
        'update' only works with 'mysql' right now.
which: string,
        either 'mysql', 'csv', or 'pickle'.
kwargs_mysql: dictionary
        additional key arguments to be passed to write_sql.</p>
</div>


                </section>
                <section id="write_csv">
                            <input id="write_csv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_csv</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span>,</span><span class="param">	<span class="n">create_folder</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">other_paras</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="write_csv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#write_csv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="write_csv-557"><a href="#write_csv-557"><span class="linenos">557</span></a><span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="write_csv-558"><a href="#write_csv-558"><span class="linenos">558</span></a>	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">create_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">):</span>
</span><span id="write_csv-559"><a href="#write_csv-559"><span class="linenos">559</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="write_csv-560"><a href="#write_csv-560"><span class="linenos">560</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="write_csv-561"><a href="#write_csv-561"><span class="linenos">561</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="write_csv-562"><a href="#write_csv-562"><span class="linenos">562</span></a>
</span><span id="write_csv-563"><a href="#write_csv-563"><span class="linenos">563</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">!=</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="write_csv-564"><a href="#write_csv-564"><span class="linenos">564</span></a>		<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;You chose to save in csv with mode&#39;</span><span class="p">,</span> <span class="n">how</span><span class="p">)</span>
</span><span id="write_csv-565"><a href="#write_csv-565"><span class="linenos">565</span></a>		<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;This is not implemented yet, shall I switch to &#39;replace&#39;?&quot;</span><span class="p">):</span>
</span><span id="write_csv-566"><a href="#write_csv-566"><span class="linenos">566</span></a>			<span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span>
</span><span id="write_csv-567"><a href="#write_csv-567"><span class="linenos">567</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="write_csv-568"><a href="#write_csv-568"><span class="linenos">568</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted&#39;</span><span class="p">)</span>
</span><span id="write_csv-569"><a href="#write_csv-569"><span class="linenos">569</span></a>
</span><span id="write_csv-570"><a href="#write_csv-570"><span class="linenos">570</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">==</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="write_csv-571"><a href="#write_csv-571"><span class="linenos">571</span></a>		<span class="c1"># if profile is None:</span>
</span><span id="write_csv-572"><a href="#write_csv-572"><span class="linenos">572</span></a>		<span class="c1"># 	profile = &#39;local&#39;</span>
</span><span id="write_csv-573"><a href="#write_csv-573"><span class="linenos">573</span></a>
</span><span id="write_csv-574"><a href="#write_csv-574"><span class="linenos">574</span></a>		<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="write_csv-575"><a href="#write_csv-575"><span class="linenos">575</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="write_csv-576"><a href="#write_csv-576"><span class="linenos">576</span></a>			<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_csv-577"><a href="#write_csv-577"><span class="linenos">577</span></a>				<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="write_csv-578"><a href="#write_csv-578"><span class="linenos">578</span></a>
</span><span id="write_csv-579"><a href="#write_csv-579"><span class="linenos">579</span></a>			<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="write_csv-580"><a href="#write_csv-580"><span class="linenos">580</span></a>
</span><span id="write_csv-581"><a href="#write_csv-581"><span class="linenos">581</span></a>			<span class="k">if</span> <span class="n">create_folder</span><span class="p">:</span>
</span><span id="write_csv-582"><a href="#write_csv-582"><span class="linenos">582</span></a>				<span class="n">full_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="write_csv-583"><a href="#write_csv-583"><span class="linenos">583</span></a>										<span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="write_csv-584"><a href="#write_csv-584"><span class="linenos">584</span></a>
</span><span id="write_csv-585"><a href="#write_csv-585"><span class="linenos">585</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_csv-586"><a href="#write_csv-586"><span class="linenos">586</span></a>				<span class="c1"># file is on a remote server, write it with sftp</span>
</span><span id="write_csv-587"><a href="#write_csv-587"><span class="linenos">587</span></a>				<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="write_csv-588"><a href="#write_csv-588"><span class="linenos">588</span></a>				<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="write_csv-589"><a href="#write_csv-589"><span class="linenos">589</span></a>					<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">remote_file</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="write_csv-590"><a href="#write_csv-590"><span class="linenos">590</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="write_csv-591"><a href="#write_csv-591"><span class="linenos">591</span></a>				<span class="c1"># file is local, write it directly.</span>
</span><span id="write_csv-592"><a href="#write_csv-592"><span class="linenos">592</span></a>				<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">)</span>
</span><span id="write_csv-593"><a href="#write_csv-593"><span class="linenos">593</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="write_csv-594"><a href="#write_csv-594"><span class="linenos">594</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not implemented yet&#39;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="write_pickle">
                            <input id="write_pickle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_pickle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span>,</span><span class="param">	<span class="n">create_folder</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">byte</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">other_paras</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="write_pickle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#write_pickle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="write_pickle-596"><a href="#write_pickle-596"><span class="linenos">596</span></a><span class="k">def</span> <span class="nf">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="n">path</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="write_pickle-597"><a href="#write_pickle-597"><span class="linenos">597</span></a>	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="n">create_folder</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">byte</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">other_paras</span><span class="p">):</span>
</span><span id="write_pickle-598"><a href="#write_pickle-598"><span class="linenos">598</span></a>
</span><span id="write_pickle-599"><a href="#write_pickle-599"><span class="linenos">599</span></a>	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="write_pickle-600"><a href="#write_pickle-600"><span class="linenos">600</span></a>	<span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="write_pickle-601"><a href="#write_pickle-601"><span class="linenos">601</span></a>
</span><span id="write_pickle-602"><a href="#write_pickle-602"><span class="linenos">602</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">!=</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="write_pickle-603"><a href="#write_pickle-603"><span class="linenos">603</span></a>		<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;You chose to save in pickle with mode&#39;</span><span class="p">,</span> <span class="n">how</span><span class="p">)</span>
</span><span id="write_pickle-604"><a href="#write_pickle-604"><span class="linenos">604</span></a>		<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;This is not implemented yet, shall I switch to &#39;replace&#39;?&quot;</span><span class="p">):</span>
</span><span id="write_pickle-605"><a href="#write_pickle-605"><span class="linenos">605</span></a>			<span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;replace&#39;</span>
</span><span id="write_pickle-606"><a href="#write_pickle-606"><span class="linenos">606</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="write_pickle-607"><a href="#write_pickle-607"><span class="linenos">607</span></a>			<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted&#39;</span><span class="p">)</span>
</span><span id="write_pickle-608"><a href="#write_pickle-608"><span class="linenos">608</span></a>
</span><span id="write_pickle-609"><a href="#write_pickle-609"><span class="linenos">609</span></a>	<span class="k">if</span> <span class="n">how</span><span class="o">==</span><span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="write_pickle-610"><a href="#write_pickle-610"><span class="linenos">610</span></a>		<span class="k">if</span> <span class="n">byte</span><span class="p">:</span>
</span><span id="write_pickle-611"><a href="#write_pickle-611"><span class="linenos">611</span></a>			<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;wb&#39;</span>
</span><span id="write_pickle-612"><a href="#write_pickle-612"><span class="linenos">612</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="write_pickle-613"><a href="#write_pickle-613"><span class="linenos">613</span></a>			<span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>
</span><span id="write_pickle-614"><a href="#write_pickle-614"><span class="linenos">614</span></a>
</span><span id="write_pickle-615"><a href="#write_pickle-615"><span class="linenos">615</span></a>		<span class="k">with</span> <span class="n">file_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file_connection</span><span class="p">:</span>
</span><span id="write_pickle-616"><a href="#write_pickle-616"><span class="linenos">616</span></a>			<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="write_pickle-617"><a href="#write_pickle-617"><span class="linenos">617</span></a>			<span class="k">if</span> <span class="n">ppath</span><span class="o">.</span><span class="n">anchor</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_pickle-618"><a href="#write_pickle-618"><span class="linenos">618</span></a>				<span class="n">ppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;base_path&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">path</span>
</span><span id="write_pickle-619"><a href="#write_pickle-619"><span class="linenos">619</span></a>
</span><span id="write_pickle-620"><a href="#write_pickle-620"><span class="linenos">620</span></a>			<span class="n">full_path</span> <span class="o">=</span> <span class="n">ppath</span> <span class="o">/</span> <span class="n">file_name</span>
</span><span id="write_pickle-621"><a href="#write_pickle-621"><span class="linenos">621</span></a>
</span><span id="write_pickle-622"><a href="#write_pickle-622"><span class="linenos">622</span></a>			<span class="k">if</span> <span class="n">create_folder</span><span class="p">:</span>
</span><span id="write_pickle-623"><a href="#write_pickle-623"><span class="linenos">623</span></a>				<span class="n">full_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="write_pickle-624"><a href="#write_pickle-624"><span class="linenos">624</span></a>										<span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="write_pickle-625"><a href="#write_pickle-625"><span class="linenos">625</span></a>
</span><span id="write_pickle-626"><a href="#write_pickle-626"><span class="linenos">626</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_pickle-627"><a href="#write_pickle-627"><span class="linenos">627</span></a>				<span class="c1"># file is on a remote server, write it with sftp</span>
</span><span id="write_pickle-628"><a href="#write_pickle-628"><span class="linenos">628</span></a>				<span class="n">sftp_client</span> <span class="o">=</span> <span class="n">my_file_connection</span><span class="p">[</span><span class="s1">&#39;ssh_connection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">open_sftp</span><span class="p">()</span>
</span><span id="write_pickle-629"><a href="#write_pickle-629"><span class="linenos">629</span></a>				<span class="k">with</span> <span class="n">sftp_client</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">full_path</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">remote_file</span><span class="p">:</span>
</span><span id="write_pickle-630"><a href="#write_pickle-630"><span class="linenos">630</span></a>					<span class="c1">#df = pd.read_csv(remote_file, **other_paras)</span>
</span><span id="write_pickle-631"><a href="#write_pickle-631"><span class="linenos">631</span></a>					<span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">remote_file</span><span class="p">)</span>
</span><span id="write_pickle-632"><a href="#write_pickle-632"><span class="linenos">632</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="write_pickle-633"><a href="#write_pickle-633"><span class="linenos">633</span></a>				<span class="c1"># file is local, write it directly.</span>
</span><span id="write_pickle-634"><a href="#write_pickle-634"><span class="linenos">634</span></a>				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="write_pickle-635"><a href="#write_pickle-635"><span class="linenos">635</span></a>					<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="write_pickle-636"><a href="#write_pickle-636"><span class="linenos">636</span></a>	<span class="k">else</span><span class="p">:</span>
</span><span id="write_pickle-637"><a href="#write_pickle-637"><span class="linenos">637</span></a>		<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not implemented yet&#39;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="create_indexes_in_table">
                            <input id="create_indexes_in_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_indexes_in_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">connection</span>, </span><span class="param"><span class="n">table</span>, </span><span class="param"><span class="n">primary</span><span class="o">=</span><span class="p">{}</span>, </span><span class="param"><span class="n">indexes</span><span class="o">=</span><span class="p">{}</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="create_indexes_in_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_indexes_in_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_indexes_in_table-639"><a href="#create_indexes_in_table-639"><span class="linenos">639</span></a><span class="k">def</span> <span class="nf">create_indexes_in_table</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">primary</span><span class="o">=</span><span class="p">{},</span> <span class="n">indexes</span><span class="o">=</span><span class="p">{}):</span>
</span><span id="create_indexes_in_table-640"><a href="#create_indexes_in_table-640"><span class="linenos">640</span></a>	<span class="k">if</span> <span class="ow">not</span> <span class="n">primary</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">indexes</span><span class="p">:</span>
</span><span id="create_indexes_in_table-641"><a href="#create_indexes_in_table-641"><span class="linenos">641</span></a>		<span class="c1">#Need at least one</span>
</span><span id="create_indexes_in_table-642"><a href="#create_indexes_in_table-642"><span class="linenos">642</span></a>		<span class="k">return</span>
</span><span id="create_indexes_in_table-643"><a href="#create_indexes_in_table-643"><span class="linenos">643</span></a>
</span><span id="create_indexes_in_table-644"><a href="#create_indexes_in_table-644"><span class="linenos">644</span></a>	<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;ALTEr TABLE &quot;</span><span class="o">+</span><span class="n">table</span>
</span><span id="create_indexes_in_table-645"><a href="#create_indexes_in_table-645"><span class="linenos">645</span></a>	
</span><span id="create_indexes_in_table-646"><a href="#create_indexes_in_table-646"><span class="linenos">646</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">primary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="create_indexes_in_table-647"><a href="#create_indexes_in_table-647"><span class="linenos">647</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">+</span><span class="s2">&quot; CHANGE COLUMN &quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">v</span><span class="o">+</span><span class="s2">&quot; NOT NULL, &quot;</span>
</span><span id="create_indexes_in_table-648"><a href="#create_indexes_in_table-648"><span class="linenos">648</span></a>
</span><span id="create_indexes_in_table-649"><a href="#create_indexes_in_table-649"><span class="linenos">649</span></a>	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">indexes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="create_indexes_in_table-650"><a href="#create_indexes_in_table-650"><span class="linenos">650</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span> <span class="o">+</span> <span class="s2">&quot; ADD INDEX &quot;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span>
</span><span id="create_indexes_in_table-651"><a href="#create_indexes_in_table-651"><span class="linenos">651</span></a>		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
</span><span id="create_indexes_in_table-652"><a href="#create_indexes_in_table-652"><span class="linenos">652</span></a>			<span class="n">sql</span> <span class="o">+=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="s2">&quot; ASC, &quot;</span><span class="p">)</span>
</span><span id="create_indexes_in_table-653"><a href="#create_indexes_in_table-653"><span class="linenos">653</span></a>
</span><span id="create_indexes_in_table-654"><a href="#create_indexes_in_table-654"><span class="linenos">654</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="create_indexes_in_table-655"><a href="#create_indexes_in_table-655"><span class="linenos">655</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot;),&quot;</span>
</span><span id="create_indexes_in_table-656"><a href="#create_indexes_in_table-656"><span class="linenos">656</span></a>
</span><span id="create_indexes_in_table-657"><a href="#create_indexes_in_table-657"><span class="linenos">657</span></a>	<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">primary</span><span class="p">):</span>
</span><span id="create_indexes_in_table-658"><a href="#create_indexes_in_table-658"><span class="linenos">658</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot; ADD PRIMARY KEY (&quot;</span>
</span><span id="create_indexes_in_table-659"><a href="#create_indexes_in_table-659"><span class="linenos">659</span></a>		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">primary</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="create_indexes_in_table-660"><a href="#create_indexes_in_table-660"><span class="linenos">660</span></a>			<span class="n">sql</span> <span class="o">+=</span> <span class="n">k</span><span class="o">+</span><span class="s2">&quot;,&quot;</span>
</span><span id="create_indexes_in_table-661"><a href="#create_indexes_in_table-661"><span class="linenos">661</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="create_indexes_in_table-662"><a href="#create_indexes_in_table-662"><span class="linenos">662</span></a>		<span class="n">sql</span> <span class="o">+=</span> <span class="s2">&quot;),&quot;</span>
</span><span id="create_indexes_in_table-663"><a href="#create_indexes_in_table-663"><span class="linenos">663</span></a>
</span><span id="create_indexes_in_table-664"><a href="#create_indexes_in_table-664"><span class="linenos">664</span></a>	<span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="create_indexes_in_table-665"><a href="#create_indexes_in_table-665"><span class="linenos">665</span></a>	
</span><span id="create_indexes_in_table-666"><a href="#create_indexes_in_table-666"><span class="linenos">666</span></a>	<span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="write_mysql">
                            <input id="write_mysql-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_mysql</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">table_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">how</span><span class="o">=</span><span class="s1">&#39;update&#39;</span>,</span><span class="param">	<span class="n">key_for_update</span><span class="o">=</span><span class="s1">&#39;id&#39;</span>,</span><span class="param">	<span class="n">keys_for_update</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">connection</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">primary_dict</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">hard_update</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">index</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">use_temp_csv</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="write_mysql-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#write_mysql"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="write_mysql-668"><a href="#write_mysql-668"><span class="linenos">668</span></a><span class="k">def</span> <span class="nf">write_mysql</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="n">key_for_update</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> 
</span><span id="write_mysql-669"><a href="#write_mysql-669"><span class="linenos">669</span></a>	<span class="n">keys_for_update</span><span class="o">=</span><span class="p">{},</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">primary_dict</span><span class="o">=</span><span class="p">{},</span>
</span><span id="write_mysql-670"><a href="#write_mysql-670"><span class="linenos">670</span></a>	<span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hard_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_temp_csv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="write_mysql-671"><a href="#write_mysql-671"><span class="linenos">671</span></a><span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="write_mysql-672"><a href="#write_mysql-672"><span class="linenos">672</span></a><span class="sd">	</span>
</span><span id="write_mysql-673"><a href="#write_mysql-673"><span class="linenos">673</span></a><span class="sd">	Write a dataframe in the mysql database</span>
</span><span id="write_mysql-674"><a href="#write_mysql-674"><span class="linenos">674</span></a>
</span><span id="write_mysql-675"><a href="#write_mysql-675"><span class="linenos">675</span></a><span class="sd">	Parameters</span>
</span><span id="write_mysql-676"><a href="#write_mysql-676"><span class="linenos">676</span></a><span class="sd">	==========</span>
</span><span id="write_mysql-677"><a href="#write_mysql-677"><span class="linenos">677</span></a><span class="sd">	data: pandas DataFrame object,</span>
</span><span id="write_mysql-678"><a href="#write_mysql-678"><span class="linenos">678</span></a><span class="sd">		stuff to be put in database.</span>
</span><span id="write_mysql-679"><a href="#write_mysql-679"><span class="linenos">679</span></a><span class="sd">	table_name: string,</span>
</span><span id="write_mysql-680"><a href="#write_mysql-680"><span class="linenos">680</span></a><span class="sd">		name of table in database.</span>
</span><span id="write_mysql-681"><a href="#write_mysql-681"><span class="linenos">681</span></a><span class="sd">	how: string,</span>
</span><span id="write_mysql-682"><a href="#write_mysql-682"><span class="linenos">682</span></a><span class="sd">		either &#39;update&#39;, &#39;replace&#39;, or &#39;append&#39;.</span>
</span><span id="write_mysql-683"><a href="#write_mysql-683"><span class="linenos">683</span></a><span class="sd">	key_for_update: string, int, float, or list</span>
</span><span id="write_mysql-684"><a href="#write_mysql-684"><span class="linenos">684</span></a><span class="sd">		name of key(s) for table row matching.</span>
</span><span id="write_mysql-685"><a href="#write_mysql-685"><span class="linenos">685</span></a><span class="sd">	engine: sqlalchemy engine object </span>
</span><span id="write_mysql-686"><a href="#write_mysql-686"><span class="linenos">686</span></a><span class="sd">		If given then it is used to do the connection,</span>
</span><span id="write_mysql-687"><a href="#write_mysql-687"><span class="linenos">687</span></a><span class="sd">		if missing then it is created based on default parameters</span>
</span><span id="write_mysql-688"><a href="#write_mysql-688"><span class="linenos">688</span></a>
</span><span id="write_mysql-689"><a href="#write_mysql-689"><span class="linenos">689</span></a><span class="sd">	TODO: harmonise keys_for_update and key_for_update</span>
</span><span id="write_mysql-690"><a href="#write_mysql-690"><span class="linenos">690</span></a><span class="sd">	</span>
</span><span id="write_mysql-691"><a href="#write_mysql-691"><span class="linenos">691</span></a><span class="sd">	&quot;&quot;&quot;</span>
</span><span id="write_mysql-692"><a href="#write_mysql-692"><span class="linenos">692</span></a>
</span><span id="write_mysql-693"><a href="#write_mysql-693"><span class="linenos">693</span></a>	<span class="kn">import</span> <span class="nn">sqlalchemy</span>
</span><span id="write_mysql-694"><a href="#write_mysql-694"><span class="linenos">694</span></a>
</span><span id="write_mysql-695"><a href="#write_mysql-695"><span class="linenos">695</span></a>	<span class="k">with</span> <span class="n">mysql_connection</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
</span><span id="write_mysql-696"><a href="#write_mysql-696"><span class="linenos">696</span></a>		<span class="n">engine</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">]</span>
</span><span id="write_mysql-697"><a href="#write_mysql-697"><span class="linenos">697</span></a>		
</span><span id="write_mysql-698"><a href="#write_mysql-698"><span class="linenos">698</span></a>		<span class="c1">#create_primary_keys = not engine.dialect.has_table(table_name)</span>
</span><span id="write_mysql-699"><a href="#write_mysql-699"><span class="linenos">699</span></a>		<span class="n">create_primary_keys</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="write_mysql-700"><a href="#write_mysql-700"><span class="linenos">700</span></a>
</span><span id="write_mysql-701"><a href="#write_mysql-701"><span class="linenos">701</span></a>		<span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;replace&#39;</span><span class="p">:</span>
</span><span id="write_mysql-702"><a href="#write_mysql-702"><span class="linenos">702</span></a>			<span class="n">question</span> <span class="o">=</span> <span class="s1">&#39;You chose to replace the following database (engine: </span><span class="si">{}</span><span class="s1">) table in output:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">])</span>
</span><span id="write_mysql-703"><a href="#write_mysql-703"><span class="linenos">703</span></a>			<span class="n">question</span> <span class="o">+=</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="write_mysql-704"><a href="#write_mysql-704"><span class="linenos">704</span></a>			<span class="n">question</span> <span class="o">+=</span> <span class="s1">&#39;Are you sure?&#39;</span>
</span><span id="write_mysql-705"><a href="#write_mysql-705"><span class="linenos">705</span></a>			<span class="k">if</span> <span class="ow">not</span> <span class="n">yes</span><span class="p">(</span><span class="n">question</span><span class="p">):</span>
</span><span id="write_mysql-706"><a href="#write_mysql-706"><span class="linenos">706</span></a>				<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;Should I switch to &#39;update&#39;? (You can still save in cvs if you say no)&quot;</span><span class="p">):</span>
</span><span id="write_mysql-707"><a href="#write_mysql-707"><span class="linenos">707</span></a>					<span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;update&#39;</span>
</span><span id="write_mysql-708"><a href="#write_mysql-708"><span class="linenos">708</span></a>				<span class="k">else</span><span class="p">:</span>
</span><span id="write_mysql-709"><a href="#write_mysql-709"><span class="linenos">709</span></a>					<span class="k">if</span> <span class="n">yes</span><span class="p">(</span><span class="s2">&quot;Do you want to save the results in cvs? (Run is aborted otherwise)&quot;</span><span class="p">):</span>
</span><span id="write_mysql-710"><a href="#write_mysql-710"><span class="linenos">710</span></a>						<span class="n">file_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Type a name for the csv file:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="write_mysql-711"><a href="#write_mysql-711"><span class="linenos">711</span></a>						<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</span><span id="write_mysql-712"><a href="#write_mysql-712"><span class="linenos">712</span></a>					<span class="k">else</span><span class="p">:</span>
</span><span id="write_mysql-713"><a href="#write_mysql-713"><span class="linenos">713</span></a>						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted&#39;</span><span class="p">)</span>
</span><span id="write_mysql-714"><a href="#write_mysql-714"><span class="linenos">714</span></a>
</span><span id="write_mysql-715"><a href="#write_mysql-715"><span class="linenos">715</span></a>		<span class="k">if</span> <span class="n">how</span> <span class="o">!=</span> <span class="s1">&#39;update&#39;</span><span class="p">:</span>
</span><span id="write_mysql-716"><a href="#write_mysql-716"><span class="linenos">716</span></a>			<span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="n">how</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="write_mysql-717"><a href="#write_mysql-717"><span class="linenos">717</span></a>		<span class="k">else</span><span class="p">:</span>
</span><span id="write_mysql-718"><a href="#write_mysql-718"><span class="linenos">718</span></a>			<span class="c1">#if hard_update:</span>
</span><span id="write_mysql-719"><a href="#write_mysql-719"><span class="linenos">719</span></a>			<span class="c1"># Remove all entries with attributes matching the ones given in keys_for_update.</span>
</span><span id="write_mysql-720"><a href="#write_mysql-720"><span class="linenos">720</span></a>			<span class="c1"># TODO: This is slow and stupid, use mysql &#39;SET&#39; command</span>
</span><span id="write_mysql-721"><a href="#write_mysql-721"><span class="linenos">721</span></a>			<span class="k">if</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
</span><span id="write_mysql-722"><a href="#write_mysql-722"><span class="linenos">722</span></a>				<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
</span><span id="write_mysql-723"><a href="#write_mysql-723"><span class="linenos">723</span></a>					<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;DELETE FROM &#39;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s1">&#39; WHERE &#39;</span>
</span><span id="write_mysql-724"><a href="#write_mysql-724"><span class="linenos">724</span></a>					<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">keys_for_update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="write_mysql-725"><a href="#write_mysql-725"><span class="linenos">725</span></a>						<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="write_mysql-726"><a href="#write_mysql-726"><span class="linenos">726</span></a>							<span class="n">query</span> <span class="o">+=</span>  <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot; AND &#39;</span>
</span><span id="write_mysql-727"><a href="#write_mysql-727"><span class="linenos">727</span></a>						<span class="k">else</span><span class="p">:</span>
</span><span id="write_mysql-728"><a href="#write_mysql-728"><span class="linenos">728</span></a>							<span class="n">query</span> <span class="o">+=</span>  <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; AND &#39;</span>
</span><span id="write_mysql-729"><a href="#write_mysql-729"><span class="linenos">729</span></a>					<span class="n">rs</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
</span><span id="write_mysql-730"><a href="#write_mysql-730"><span class="linenos">730</span></a>
</span><span id="write_mysql-731"><a href="#write_mysql-731"><span class="linenos">731</span></a>				<span class="c1"># Check if all columns are in the existing table, otherwise create them </span>
</span><span id="write_mysql-732"><a href="#write_mysql-732"><span class="linenos">732</span></a>				<span class="n">df_test</span> <span class="o">=</span> <span class="n">read_mysql</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="n">table_name</span> <span class="o">+</span> <span class="s2">&quot; LIMIT 1&quot;</span><span class="p">,</span>
</span><span id="write_mysql-733"><a href="#write_mysql-733"><span class="linenos">733</span></a>									<span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
</span><span id="write_mysql-734"><a href="#write_mysql-734"><span class="linenos">734</span></a>				<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="write_mysql-735"><a href="#write_mysql-735"><span class="linenos">735</span></a>					<span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="write_mysql-736"><a href="#write_mysql-736"><span class="linenos">736</span></a>						<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Trying to add column&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;table.&quot;</span><span class="p">)</span>
</span><span id="write_mysql-737"><a href="#write_mysql-737"><span class="linenos">737</span></a>						<span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</span><span id="write_mysql-738"><a href="#write_mysql-738"><span class="linenos">738</span></a>						<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>
</span><span id="write_mysql-739"><a href="#write_mysql-739"><span class="linenos">739</span></a>							<span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;FLOAT&#39;</span>
</span><span id="write_mysql-740"><a href="#write_mysql-740"><span class="linenos">740</span></a>						<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]:</span>
</span><span id="write_mysql-741"><a href="#write_mysql-741"><span class="linenos">741</span></a>							<span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;INT&#39;</span>
</span><span id="write_mysql-742"><a href="#write_mysql-742"><span class="linenos">742</span></a>						<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="write_mysql-743"><a href="#write_mysql-743"><span class="linenos">743</span></a>							<span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;VARCHAR(100)&#39;</span>
</span><span id="write_mysql-744"><a href="#write_mysql-744"><span class="linenos">744</span></a>						<span class="c1"># elif type(data.loc[mask, col].iloc[0]) in [list, tuple]:</span>
</span><span id="write_mysql-745"><a href="#write_mysql-745"><span class="linenos">745</span></a>						<span class="c1"># 	max_car = max([len(data.loc[mask, col].iloc[i]) for i in range(len(data.loc[mask, col]))])</span>
</span><span id="write_mysql-746"><a href="#write_mysql-746"><span class="linenos">746</span></a>						<span class="c1"># 	typ = &#39;VARCHAR(&#39; + str(max_car*10) + &#39;)&#39;</span>
</span><span id="write_mysql-747"><a href="#write_mysql-747"><span class="linenos">747</span></a>						<span class="k">else</span><span class="p">:</span>
</span><span id="write_mysql-748"><a href="#write_mysql-748"><span class="linenos">748</span></a>							<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Column:&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span id="write_mysql-749"><a href="#write_mysql-749"><span class="linenos">749</span></a>							<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not sure which type of variable I should use for:&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="write_mysql-750"><a href="#write_mysql-750"><span class="linenos">750</span></a>						
</span><span id="write_mysql-751"><a href="#write_mysql-751"><span class="linenos">751</span></a>						<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;ALTER TABLE &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ADD COLUMN `&quot;</span> <span class="o">+</span>\
</span><span id="write_mysql-752"><a href="#write_mysql-752"><span class="linenos">752</span></a>								<span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;` &quot;</span> <span class="o">+</span> <span class="n">typ</span>
</span><span id="write_mysql-753"><a href="#write_mysql-753"><span class="linenos">753</span></a>
</span><span id="write_mysql-754"><a href="#write_mysql-754"><span class="linenos">754</span></a>						<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Attempting to create new column with query:&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span id="write_mysql-755"><a href="#write_mysql-755"><span class="linenos">755</span></a>						<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="write_mysql-756"><a href="#write_mysql-756"><span class="linenos">756</span></a>
</span><span id="write_mysql-757"><a href="#write_mysql-757"><span class="linenos">757</span></a>			<span class="k">if</span> <span class="n">use_temp_csv</span><span class="p">:</span>
</span><span id="write_mysql-758"><a href="#write_mysql-758"><span class="linenos">758</span></a>				<span class="c1"># TODO: replace this with odo (see below)</span>
</span><span id="write_mysql-759"><a href="#write_mysql-759"><span class="linenos">759</span></a>				<span class="n">load_data_infile</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
</span><span id="write_mysql-760"><a href="#write_mysql-760"><span class="linenos">760</span></a>			<span class="k">else</span><span class="p">:</span>
</span><span id="write_mysql-761"><a href="#write_mysql-761"><span class="linenos">761</span></a>				<span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">connection</span><span class="p">[</span><span class="s1">&#39;engine&#39;</span><span class="p">],</span> <span class="n">if_exists</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span><span id="write_mysql-762"><a href="#write_mysql-762"><span class="linenos">762</span></a>			<span class="c1"># else:</span>
</span><span id="write_mysql-763"><a href="#write_mysql-763"><span class="linenos">763</span></a>			<span class="c1"># 	# Check whether the table exists</span>
</span><span id="write_mysql-764"><a href="#write_mysql-764"><span class="linenos">764</span></a>			<span class="c1"># 	try:</span>
</span><span id="write_mysql-765"><a href="#write_mysql-765"><span class="linenos">765</span></a>			<span class="c1"># 		sql = &quot;&quot;&quot;SELECT * FROM {} LIMIT 1&quot;&quot;&quot;.format(table_name)</span>
</span><span id="write_mysql-766"><a href="#write_mysql-766"><span class="linenos">766</span></a>			<span class="c1"># 		dff = read_mysql(query=sql, connection=connection)</span>
</span><span id="write_mysql-767"><a href="#write_mysql-767"><span class="linenos">767</span></a>			<span class="c1"># 		# If it does, update</span>
</span><span id="write_mysql-768"><a href="#write_mysql-768"><span class="linenos">768</span></a>			<span class="c1"># 		_update_table(data, table_name, key_for_update, connection=connection)</span>
</span><span id="write_mysql-769"><a href="#write_mysql-769"><span class="linenos">769</span></a>			<span class="c1"># 	except sqlalchemy.exc.ProgrammingError:</span>
</span><span id="write_mysql-770"><a href="#write_mysql-770"><span class="linenos">770</span></a>			<span class="c1"># 		# Otherwise, use pandas to create it and dump the data</span>
</span><span id="write_mysql-771"><a href="#write_mysql-771"><span class="linenos">771</span></a>			<span class="c1"># 		data.to_sql(table_name, connection[&#39;engine&#39;], if_exists=&#39;append&#39;, index=index)		</span>
</span><span id="write_mysql-772"><a href="#write_mysql-772"><span class="linenos">772</span></a>
</span><span id="write_mysql-773"><a href="#write_mysql-773"><span class="linenos">773</span></a>	<span class="k">if</span> <span class="n">create_primary_keys</span><span class="p">:</span>
</span><span id="write_mysql-774"><a href="#write_mysql-774"><span class="linenos">774</span></a>		<span class="n">create_indexes_in_table</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">connection</span><span class="p">,</span>
</span><span id="write_mysql-775"><a href="#write_mysql-775"><span class="linenos">775</span></a>								<span class="n">table</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
</span><span id="write_mysql-776"><a href="#write_mysql-776"><span class="linenos">776</span></a>								<span class="n">primary</span><span class="o">=</span><span class="n">primary_dict</span><span class="p">,</span>
</span><span id="write_mysql-777"><a href="#write_mysql-777"><span class="linenos">777</span></a>								<span class="n">indexes</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write a dataframe in the mysql database</p>

<h1 id="parameters">Parameters</h1>

<p>data: pandas DataFrame object,
        stuff to be put in database.
table_name: string,
        name of table in database.
how: string,
        either 'update', 'replace', or 'append'.
key_for_update: string, int, float, or list
        name of key(s) for table row matching.
engine: sqlalchemy engine object 
        If given then it is used to do the connection,
        if missing then it is created based on default parameters</p>

<p>TODO: harmonise keys_for_update and key_for_update</p>
</div>


                </section>
                <section id="load_data_infile">
                            <input id="load_data_infile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_data_infile</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">engine</span>,</span><span class="param">	<span class="n">data</span>,</span><span class="param">	<span class="n">table</span>,</span><span class="param">	<span class="n">columns</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">drop_table</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">create_table</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">deactivate_checks_keys</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="load_data_infile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#load_data_infile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="load_data_infile-842"><a href="#load_data_infile-842"><span class="linenos">842</span></a><span class="k">def</span> <span class="nf">load_data_infile</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deactivate_checks_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="load_data_infile-843"><a href="#load_data_infile-843"><span class="linenos">843</span></a>	<span class="kn">import</span> <span class="nn">tempfile</span>
</span><span id="load_data_infile-844"><a href="#load_data_infile-844"><span class="linenos">844</span></a>
</span><span id="load_data_infile-845"><a href="#load_data_infile-845"><span class="linenos">845</span></a>	<span class="k">if</span> <span class="n">drop_table</span><span class="p">:</span>
</span><span id="load_data_infile-846"><a href="#load_data_infile-846"><span class="linenos">846</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP TABLE IF EXISTS &quot;</span> <span class="o">+</span> <span class="n">table</span><span class="p">)</span>
</span><span id="load_data_infile-847"><a href="#load_data_infile-847"><span class="linenos">847</span></a>		<span class="n">create_table</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="load_data_infile-848"><a href="#load_data_infile-848"><span class="linenos">848</span></a>
</span><span id="load_data_infile-849"><a href="#load_data_infile-849"><span class="linenos">849</span></a>	<span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="load_data_infile-850"><a href="#load_data_infile-850"><span class="linenos">850</span></a>		<span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="load_data_infile-851"><a href="#load_data_infile-851"><span class="linenos">851</span></a>
</span><span id="load_data_infile-852"><a href="#load_data_infile-852"><span class="linenos">852</span></a>	<span class="k">if</span> <span class="n">create_table</span><span class="p">:</span>
</span><span id="load_data_infile-853"><a href="#load_data_infile-853"><span class="linenos">853</span></a>		<span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="p">]</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>
</span><span id="load_data_infile-854"><a href="#load_data_infile-854"><span class="linenos">854</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;TRUNCATE &quot;</span><span class="o">+</span><span class="n">table</span><span class="p">)</span>
</span><span id="load_data_infile-855"><a href="#load_data_infile-855"><span class="linenos">855</span></a>
</span><span id="load_data_infile-856"><a href="#load_data_infile-856"><span class="linenos">856</span></a>	<span class="n">temp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>
</span><span id="load_data_infile-857"><a href="#load_data_infile-857"><span class="linenos">857</span></a>
</span><span id="load_data_infile-858"><a href="#load_data_infile-858"><span class="linenos">858</span></a>	<span class="k">try</span><span class="p">:</span>
</span><span id="load_data_infile-859"><a href="#load_data_infile-859"><span class="linenos">859</span></a>		<span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">doublequote</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">na_rep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">)</span>
</span><span id="load_data_infile-860"><a href="#load_data_infile-860"><span class="linenos">860</span></a>
</span><span id="load_data_infile-861"><a href="#load_data_infile-861"><span class="linenos">861</span></a>		<span class="k">if</span> <span class="n">deactivate_checks_keys</span><span class="p">:</span>
</span><span id="load_data_infile-862"><a href="#load_data_infile-862"><span class="linenos">862</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set autocommit = 0;&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-863"><a href="#load_data_infile-863"><span class="linenos">863</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set unique_checks = 0;&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-864"><a href="#load_data_infile-864"><span class="linenos">864</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set foreign_key_checks = 0&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-865"><a href="#load_data_infile-865"><span class="linenos">865</span></a>
</span><span id="load_data_infile-866"><a href="#load_data_infile-866"><span class="linenos">866</span></a>		<span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;`&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;`&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]</span>
</span><span id="load_data_infile-867"><a href="#load_data_infile-867"><span class="linenos">867</span></a>		
</span><span id="load_data_infile-868"><a href="#load_data_infile-868"><span class="linenos">868</span></a>		<span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;LOAD DATA LOCAL INFILE &#39;&quot;</span> <span class="o">+</span> <span class="n">temp</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>\
</span><span id="load_data_infile-869"><a href="#load_data_infile-869"><span class="linenos">869</span></a>			   <span class="o">+</span> <span class="s2">&quot; INTO TABLE &quot;</span><span class="o">+</span><span class="n">table</span> \
</span><span id="load_data_infile-870"><a href="#load_data_infile-870"><span class="linenos">870</span></a>			   <span class="o">+</span> <span class="s2">&quot; FIELDS TERMINATED BY &#39;,&#39;&quot;</span>\
</span><span id="load_data_infile-871"><a href="#load_data_infile-871"><span class="linenos">871</span></a>			   <span class="o">+</span> <span class="s2">&quot; LINES TERMINATED BY &#39;</span><span class="se">\\</span><span class="s2">n&#39;&quot;</span>\
</span><span id="load_data_infile-872"><a href="#load_data_infile-872"><span class="linenos">872</span></a>			   <span class="o">+</span> <span class="s2">&quot; IGNORE 1 LINES&quot;</span>\
</span><span id="load_data_infile-873"><a href="#load_data_infile-873"><span class="linenos">873</span></a>			   <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;);&quot;</span>
</span><span id="load_data_infile-874"><a href="#load_data_infile-874"><span class="linenos">874</span></a>
</span><span id="load_data_infile-875"><a href="#load_data_infile-875"><span class="linenos">875</span></a>		<span class="c1">#print()</span>
</span><span id="load_data_infile-876"><a href="#load_data_infile-876"><span class="linenos">876</span></a>		<span class="c1">#print(&quot;-------&quot;)</span>
</span><span id="load_data_infile-877"><a href="#load_data_infile-877"><span class="linenos">877</span></a>		<span class="c1">#print(sql)</span>
</span><span id="load_data_infile-878"><a href="#load_data_infile-878"><span class="linenos">878</span></a>		<span class="c1">#print(&quot;-------&quot;)</span>
</span><span id="load_data_infile-879"><a href="#load_data_infile-879"><span class="linenos">879</span></a>
</span><span id="load_data_infile-880"><a href="#load_data_infile-880"><span class="linenos">880</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span id="load_data_infile-881"><a href="#load_data_infile-881"><span class="linenos">881</span></a>		<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;commit;&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-882"><a href="#load_data_infile-882"><span class="linenos">882</span></a>
</span><span id="load_data_infile-883"><a href="#load_data_infile-883"><span class="linenos">883</span></a>	<span class="k">finally</span><span class="p">:</span>
</span><span id="load_data_infile-884"><a href="#load_data_infile-884"><span class="linenos">884</span></a>		<span class="k">if</span> <span class="n">deactivate_checks_keys</span><span class="p">:</span>
</span><span id="load_data_infile-885"><a href="#load_data_infile-885"><span class="linenos">885</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set autocommit = 1;&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-886"><a href="#load_data_infile-886"><span class="linenos">886</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set unique_checks = 1;&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-887"><a href="#load_data_infile-887"><span class="linenos">887</span></a>			<span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;set foreign_key_checks = 1&#39;</span><span class="p">)</span>
</span><span id="load_data_infile-888"><a href="#load_data_infile-888"><span class="linenos">888</span></a>
</span><span id="load_data_infile-889"><a href="#load_data_infile-889"><span class="linenos">889</span></a>		<span class="n">temp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>